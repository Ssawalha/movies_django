<!DOCTYPE html>
<html lang="en">

<head>









    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
            <title>OUTBREAK
 - Taj Cinemas</title>
		<meta name="description" content="A State Park Ranger and his wife, grappling with the disappearance of their teenage son, face a mysterious outbreak that threatens not only their relationship, but in the end, their grip on reality.

">
        <meta property="og:title" content="OUTBREAK
">
        <meta property="og:type" content="Website">

        <meta property="og:description" content="A State Park Ranger and his wife, grappling with the disappearance of their teenage son, face a mysterious outbreak that threatens not only their relationship, but in the end, their grip on reality.

 ">
        <meta property="og:image" content="/storage/01JMFPJT3R463YV4GD8764XB6P.jpg
">
        <link rel="image_src" href="/storage/01JMFPJT3R463YV4GD8764XB6P.jpg
">


    <!-- Favicon -->
    <link rel="shortcut icon" href="https://tajcinemas.com/favicon.png">

    <!-- Fonts -->
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">


	 <link rel="preload" as="style" href="https://tajcinemas.com/build/assets/app-2baf860b.css" /><link rel="modulepreload" href="https://tajcinemas.com/build/assets/app-89e4efe6.js" /><link rel="stylesheet" href="https://tajcinemas.com/build/assets/app-2baf860b.css" data-navigate-track="reload" /><script type="module" src="https://tajcinemas.com/build/assets/app-89e4efe6.js" data-navigate-track="reload"></script>	<script src="/js/jquery_min.js"></script>
    <!-- Livewire Styles --><style >[wire\:loading][wire\:loading], [wire\:loading\.delay][wire\:loading\.delay], [wire\:loading\.inline-block][wire\:loading\.inline-block], [wire\:loading\.inline][wire\:loading\.inline], [wire\:loading\.block][wire\:loading\.block], [wire\:loading\.flex][wire\:loading\.flex], [wire\:loading\.table][wire\:loading\.table], [wire\:loading\.grid][wire\:loading\.grid], [wire\:loading\.inline-flex][wire\:loading\.inline-flex] {display: none;}[wire\:loading\.delay\.none][wire\:loading\.delay\.none], [wire\:loading\.delay\.shortest][wire\:loading\.delay\.shortest], [wire\:loading\.delay\.shorter][wire\:loading\.delay\.shorter], [wire\:loading\.delay\.short][wire\:loading\.delay\.short], [wire\:loading\.delay\.default][wire\:loading\.delay\.default], [wire\:loading\.delay\.long][wire\:loading\.delay\.long], [wire\:loading\.delay\.longer][wire\:loading\.delay\.longer], [wire\:loading\.delay\.longest][wire\:loading\.delay\.longest] {display: none;}[wire\:offline][wire\:offline] {display: none;}[wire\:dirty]:not(textarea):not(input):not(select) {display: none;}:root {--livewire-progress-bar-color: #2299dd;}[x-cloak] {display: none !important;}</style>
    <!-- Livewire Scripts -->
<script src="/livewire/livewire.js?id=cc800bf4"   data-csrf="iO5PXyCSDpZbL4so1wEFAs9WQmf2Fbx8H33HXycX" data-update-uri="/livewire/update" data-navigate-once="true"></script>

	<style>
	.rev_slider_wrapper {
    background: url(/images/header/main_slider_bg_img.jpg)50% 0 repeat-y;
    background-image: url(/images/header/main_slider_bg_img.webp);
    background-position-x: 50%;
    background-position-y: 0px;
    background-size: initial;
    background-repeat: repeat-y;
    background-attachment: initial;
    background-origin: initial;
    background-clip: initial;
    background-color: initial;
    background-position: center 0;
    background-size: cover;
    width: 100%;
    height: 100%;
    float: left;
    position: relative;
}

	</style>
</head>

<body>
        <!-- preloader Start -->
<style>
@media (max-width: 769px){
	.prs_slidebar_wrapper{
		display:block!important;
	}
	.prs_mobail_searchbar_wrapper{
		display:block;
		position: relative;
		top: 10px;
		right: 15px;
		cursor: pointer;
		color:#ffffff;
	}
}
.mobile-list-nav {
    padding: 50px 0;
    position: relative;
    z-index: 90;
    padding-left: 25px;
}
.prs_upcom_movie_img_box img {
    width: 100%;
    height: 300px;
    -webkit-border-top-right-radius: 10px;
    -moz-border-top-right-radius: 10px;
    border-top-right-radius: 10px;
    -webkit-border-top-left-radius: 10px;
    -moz-border-top-left-radius: 10px;
    border-top-left-radius: 10px;
}
</style>
	<div id="preloader" style="background-color: #000;">
	<div id="status">
			<img src="/images/header/logo.png" id="preloader_image" alt="loader">
			 <div class="loader2"></div>
		</div>
	</div>

	<!-- prs navigation Start -->
	<div class="prs_navigation_main_wrapper">
		<div class="container-fluid">
			<div id="search_open" class="gc_search_box">
			<form action="https://tajcinemas.com" method="GET">
				<input type="search" id="search" name="search" type="text" required value="" placeholder="Search here">
				<button type="submit"><i class="fa fa-search" aria-hidden="true"></i>
				</button>
			</form>
			</div>
			<div class="prs_navi_left_main_wrapper">
				<div class="prs_logo_main_wrapper">
					<a href="/">
						<img src="/images/header/logo.png" alt="logo" />
					</a>
				</div>
				<div class="prs_menu_main_wrapper">
					<nav class="navbar navbar-default">
						<div id="dl-menu" class="xv-menuwrapper responsive-menu">

							<div class="clearfix"></div>
							<ul class="dl-menu">
								<li class="parent"><a href="/">HOME</a>

								</li>
								<li class="parent"><a href="/aboutus">About Us</a>


								</li>

								<li class="parent"><a href="/tajexperience">Taj Experience</a>

								</li>
								<li class="parent"><a href="/careers">Careers</a>

								</li>

								<li class="parent"><a href="/contact">Contact</a>
								</li>
							</ul>
						</div>
						<!-- /dl-menuwrapper -->
					</nav>
				</div>
			</div>
			<div class="prs_navi_right_main_wrapper">
				<div class="prs_slidebar_wrapper">
					<button class="second-nav-toggler" type="button">
						<img src="/images/header/bars.png" alt="bar_png">
					</button>
				</div>

						<div class="prs_top_login_btn_wrapper">
							<div class="prs_animate_btn1">
								<ul>
									<li>
									<a href="https://tajcinemas.com/register" data-text="register" class="button button--tamaya" ><span> register</span></a>
									</li>

								</ul>
							</div>

						</div>

						<div class="prs_top_login_btn_wrapper">
							<div class="prs_animate_btn1">
								<ul>
									<li>
									<a href="https://tajcinemas.com/login" data-text="Log in" class="button button--tamaya" ><span> Log in</span></a>
									</li>

								</ul>
							</div>

						</div>



					</div>
				</div>
			</div>


			<div id="mobile-nav" data-prevent-default="true" data-mouse-events="true">
				<div class="mobail_nav_overlay"></div>
				<div class="mobile-nav-box">
					<div class="mobile-logo">

						<a href="#" class="manu-close" style=" margin-top: 20px; "><i class="fa fa-times" ></i></a>
					</div>
					<ul class="mobile-list-nav">
						<li><a href="/">HOME</a>
						</li>
						<li><a href="/aboutus">About Us</a>
						</li>
						<li><a href="/tajexperience">Taj Experience</a>
						</li>
						<li><a href="/careers">Careers</a>
						</li>
						<li><a href="/contact">Contact</a>
						</li>

					</ul>

					 					 					<div class="prs_top_login_btn_wrapper prs_slidebar_searchbar_btn_wrapper">
						<div class="prs_animate_btn1">
							<ul>
								<li><a href="https://tajcinemas.com/register" class="button button--tamaya" data-text="sign up" ><span>sign up</span></a>
								</li>
							</ul>
						</div>
					</div>
					<div class="prs_top_login_btn_wrapper prs_slidebar_searchbar_btn_wrapper">
						<div class="prs_animate_btn1">
							<ul>
								<li><a href="https://tajcinemas.com/login" class="button button--tamaya" data-text="login" ><span>login</span></a>
								</li>
							</ul>
						</div>
					</div>
														</div>
			</div>


		</div>
	</div>
	<!-- prs navigation End -->
	<div style=" margin-top: 97px; ">
	</div>
    <style>
    .st_video_slider_inner_wrapper {
        background: url(/storage/01JMFPJT3R463YV4GD8764XB6P.jpg) 50% 0 repeat-y!important;
        background-position: center 0;
        background-size: cover;
        border: 6px solid #FFFFFF;
        box-shadow: 0 4px 16px 0 rgba(0,0,0,0.38);
        padding-top: 80px;
        position: relative;
    }
    .prs_upcome_tabs_wrapper {
        float: left;
        width: 100%;

        padding-top: 0;
    }
    </style>
	<script>
	$(document).ready(function() {
  $('.link-525').magnificPopup({
						type: 'iframe',
						iframe: {
							markup: '<div class="mfp-iframe-scaler">'+
								'<div class="mfp-close"></div>'+
								'<iframe class="mfp-iframe" frameborder="0" allowfullscreen></iframe>'+
								'<div class="mfp-title">Some caption</div>'+
								'</div>',
							patterns: {
								youtube: {
									index: 'youtube.com/',
									id: 'v=',
									src: 'https://www.youtube.com/embed/3uuJS-bZXdw?si=GdHg-kJzz4swWGM0'
								}
							}
						}
						// other options
					});
});



	</script>
        <!-- prs video top Start -->
        <div class="prs_top_video_section_wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="st_video_slider_inner_wrapper float_left">
                            <div class="st_video_slider_overlay"></div>
                            <div class="st_video_slide_sec float_left">
                                <a rel='external' href='https://www.youtube.com/embed/3uuJS-bZXdw?si=GdHg-kJzz4swWGM0' title='title' class="test-popup-link link-525">
                                    <img src="/images/index_III/icon.png" alt="img">
                                </a>
                                <h3>OUTBREAK</h3>

                                <h4>Horror, Thriller</h4>
                                <h5 style=" padding: 10px; background-color: #e9be06; border-radius: 50%; color: #fff; ">15+</h5>
                            </div>
                            <div class="st_video_slide_social float_left">

                                <div class="st_video_slide_social_left float_left">
                                    <ul>
                                        <li><a href="#"><i class="fa fa-facebook-f"></i></a>
                                        </li>
                                        <li><a href="#"><i class="fa fa-twitter"></i></a>
                                        </li>
                                        <li><a href="#"><i class="fa fa-linkedin"></i></a>
                                        </li>
                                        <li><a href="#"><i class="fa fa-youtube"></i></a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="st_video_slide_social_right float_left">
                                    <ul>
                                        <li data-animation="animated fadeInUp" class=""><i class="far fa-calendar-alt"></i>19 Feb, 25</li>

                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- prs video top End -->
        <!-- st slider rating wrapper Start -->
        <div  class="st_slider_rating_main_wrapper float_left">
            <div class="container">
                <div class="st_slider_rating_left">
                    <div class="st_rating_box">

                        <h3>OUTBREAK</h3>
                    </div>


                </div>

				<div class="st_slider_rating_right">
                    <div class="st_slider_rating_btn prs_animate_btn1">
                        <ul>
                            <li data-animation="animated fadeInUp">
							<a href="#booking-dates" class="button button--tamaya prs_upcom_main_btn" data-text="book now"><span>book now</span></a>
                                            </li>
                        </ul>
                    </div>

                </div>
            </div>
			<div class="container">
			<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 hidden-xs hidden-sm" style="padding-right: 8px; padding-left: 8px;" bis_skin_checked="1">
											<div class="prs_upcom_movie_box_wrapper" bis_skin_checked="1">
												<div class="prs_upcom_movie_img_box" bis_skin_checked="1">
													<img src="/storage/01JMFPJT3PFKV6SKGXA2X33BS6.jpg" alt="movie_img" style=" height: 100%; ">
													<div class="prs_upcom_movie_img_overlay" bis_skin_checked="1"></div>
													<div class="prs_upcom_movie_img_btn_wrapper" bis_skin_checked="1">

													</div>
												</div>

											</div>
										</div>
               <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
			   <div class="">
                                                        <h5 style=" color: #e7bc06; ">SYNOPSIS</h5>
                                                        <p style=" padding-top: 10px; padding-bottom: 10px; ">A State Park Ranger and his wife, grappling with the disappearance of their teenage son, face a mysterious outbreak that threatens not only their relationship, but in the end, their grip on reality.
</p>
														<div class="cast" bis_skin_checked="1"><b>Cast:</b> <i>Billy Burke, Taylor Handley, Raoul Max Trujillo</i></div>
															<div class="cast" bis_skin_checked="1"><b>Duration:</b> <i>88</i> Minutes</div>
                                                    </div>
			   </div>
            </div>
        </div>
        <!-- st slider rating wrapper End -->

<!-- st slider rating wrapper Start -->
<div id="booking-dates" class="st_slider_rating_main_wrapper float_left" style=" background: #eabe06; ">

    <div class="container">
        <div class="st_calender_tabs">
            <h2>Movie Booking</h2>
            <ul class="nav nav-tabs">
                                <li class=""> <a data-toggle="tab" href="#date-319"><span>Sun</span> <br> 23</a>
                </li>


                            <li class=""> <a data-toggle="tab" href="#date-320"><span>Mon</span> <br> 24</a>
                </li>


                            <li class=""> <a data-toggle="tab" href="#date-321"><span>Tue</span> <br> 25</a>
                </li>


                            <li class=""> <a data-toggle="tab" href="#date-322"><span>Wed</span> <br> 26</a>
                </li>




            </ul>
        </div>
    </div>
</div>
<!-- st slider rating wrapper End -->
<!-- st slider sidebar wrapper Start -->
<div class="st_slider_index_sidebar_main_wrapper st_slider_index_sidebar_main_wrapper_booking float_left">
    <div class="">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="st_indx_slider_main_container float_left">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="tab-content">


                                <div id="date-319" class="tab-pane ">
                                    <div class="st_calender_contant_main_wrapper float_left">
                                        <div class="st_calender_row_cont float_left">
                                            <div class="st_calender_asc">

                                                <div class="st_calen_asc_heart_cont">
                                                    <h3>TAJ</h3>

                                                </div>
                                            </div>
                                            <div id="myshows" class="st_calen_asc_tecket_time_select">

                                                <ul class="shows" style="color: #000;">








                                                    <li id="$showtime->start_time" class="timesort">
                                                        <a href="https://tajcinemas.com/movies/525/book/319/22723" type="button"
            class="hover:bg-primary-600 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg
            opacity-50 cursor-not-allowed"
            disabled>
            16:00
        </a>


                                                    </li>









                                                </ul>
                                            </div>
                                        </div>


                                </div>
                                </div>


                                <div id="date-320" class="tab-pane ">
                                    <div class="st_calender_contant_main_wrapper float_left">
                                        <div class="st_calender_row_cont float_left">
                                            <div class="st_calender_asc">

                                                <div class="st_calen_asc_heart_cont">
                                                    <h3>TAJ</h3>

                                                </div>
                                            </div>
                                            <div id="myshows" class="st_calen_asc_tecket_time_select">

                                                <ul class="shows" style="color: #000;">








                                                    <li id="$showtime->start_time" class="timesort">
                                                        <a href="https://tajcinemas.com/movies/525/book/320/22724" type="button"
            class="hover:bg-primary-600 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg
            "
            >
            16:00
        </a>


                                                    </li>









                                                </ul>
                                            </div>
                                        </div>


                                </div>
                                </div>


                                <div id="date-321" class="tab-pane ">
                                    <div class="st_calender_contant_main_wrapper float_left">
                                        <div class="st_calender_row_cont float_left">
                                            <div class="st_calender_asc">

                                                <div class="st_calen_asc_heart_cont">
                                                    <h3>TAJ</h3>

                                                </div>
                                            </div>
                                            <div id="myshows" class="st_calen_asc_tecket_time_select">

                                                <ul class="shows" style="color: #000;">








                                                    <li id="$showtime->start_time" class="timesort">
                                                        <a href="https://tajcinemas.com/movies/525/book/321/22725" type="button"
            class="hover:bg-primary-600 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg
            "
            >
            16:00
        </a>


                                                    </li>









                                                </ul>
                                            </div>
                                        </div>


                                </div>
                                </div>


                                <div id="date-322" class="tab-pane ">
                                    <div class="st_calender_contant_main_wrapper float_left">
                                        <div class="st_calender_row_cont float_left">
                                            <div class="st_calender_asc">

                                                <div class="st_calen_asc_heart_cont">
                                                    <h3>TAJ</h3>

                                                </div>
                                            </div>
                                            <div id="myshows" class="st_calen_asc_tecket_time_select">

                                                <ul class="shows" style="color: #000;">








                                                    <li id="$showtime->start_time" class="timesort">
                                                        <a href="https://tajcinemas.com/movies/525/book/322/22726" type="button"
            class="hover:bg-primary-600 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg
            "
            >
            16:00
        </a>


                                                    </li>









                                                </ul>
                                            </div>
                                        </div>


                                </div>
                                </div>



                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



        <!-- prs Newsletter Wrapper Start -->
        <div class="prs_newsletter_wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">
                        <div class="prs_newsletter_text">
                            <h3>Get update sign up now !</h3>
                        </div>
                    </div>
                    <div class="col-lg-7 col-md-7 col-sm-12 col-xs-12">
                        <div class="prs_newsletter_field">
                            <input type="text" placeholder="Enter Your Email">
                            <button type="submit">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- prs Newsletter Wrapper End -->



	 <div class="prs_footer_main_section_wrapper">
		<div class="container">
			<div class="row">
			<div class="col-lg-4 col-md-3 col-sm-6 col-xs-12">
					<div class="prs_footer_cont1_wrapper prs_footer_cont1_wrapper_1">

						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<a href="/">
						<img src="/images/header/logo.png" alt="logo" style="
    height: 100px;
">
					</a>

				</div>

				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

					<p style="
    padding-top: 0px;
    padding-bottom: 30px;
">Copyright © Taj cinemas. All rights reserved.</p>
				</div>

					</div>
				</div>
				<div class="col-lg-4 col-md-3 col-sm-6 col-xs-12">
					<div class="prs_footer_cont1_wrapper prs_footer_cont1_wrapper_1">
						<h2>links</h2>
						<ul>
							<li><i class="fa fa-circle"></i> &nbsp;&nbsp;<a href="/aboutus">About Us</a>
							</li>

							<li><i class="fa fa-circle"></i> &nbsp;&nbsp;<a href="/careers">Careers</a>
							</li>

							<li><i class="fa fa-circle"></i> &nbsp;&nbsp;<a href="/contact">Contact</a>
							</li>

						</ul>
					</div>
				</div>

				<div class="col-lg-4 col-md-3 col-sm-6 col-xs-12">
					<div class="prs_footer_cont1_wrapper prs_footer_cont1_wrapper_4">
						<h2>App available soon on</h2>

						<ul>
							<li>
								<a href="#">
									<img src="/images/content/f1.jpg" alt="footer_img">
								</a>
							</li>
							<li>
								<a href="#">
									<img src="/images/content/f2.jpg" alt="footer_img">
								</a>
							</li>
						</ul>

					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="prs_bottom_footer_wrapper">	<a href="javascript:" id="return-to-top"><i class="flaticon-play-button"></i></a>
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-md-6 col-sm-8 col-xs-12">
					<div class="prs_bottom_footer_cont_wrapper">
						<p>Copyright 2024 <a href="#">TAJ</a> . All rights reserved - developed by <a href="https://isecurityweb.com/">192Production</a>
						</p>
					</div>
				</div>
				<div class="col-lg-6 col-md-6 col-sm-4 col-xs-12">
					<div class="prs_footer_social_wrapper">
						<ul>
							<li><a href="https://www.facebook.com/TAJCinemasJo/"><i class="fa fa-facebook"></i></a>
							</li>
							<li><a href="https://twitter.com/TajCinemas"><i class="fa fa-twitter"></i></a>
							</li>

						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- prs footer Wrapper End -->
	<!-- st login wrapper Start -->
	<div class="modal fade st_pop_form_wrapper" id="myModal" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<div class="st_pop_form_heading_wrapper float_left">
					<h3>Log in</h3>
				</div>
				<div class="st_profile_input float_left">
					<label>Email / Mobile Number</label>
					<input type="text">
				</div>
				<div class="st_profile__pass_input st_profile__pass_input_pop float_left">
					<input type="password" placeholder="Password">
				</div>
				<div class="st_form_pop_fp float_left">
					<h3><a href="#" data-toggle="modal" data-target="#myModa2" target="_blank">Forgot Password?</a></h3>
				</div>
				<div class="st_form_pop_login_btn float_left">	<a href="page-1-7_profile_settings.html">LOGIN</a>
				</div>
				<div class="st_form_pop_or_btn float_left">
					<h4>or</h4>
				</div>
				<div class="st_form_pop_facebook_btn float_left">	<a href="#"> Connect with Facebook</a>
				</div>
				<div class="st_form_pop_gmail_btn float_left">	<a href="#"> Connect with Google</a>
				</div>
				<div class="st_form_pop_signin_btn float_left">
					<h4>Don’t have an account? <a href="#" data-toggle="modal" data-target="#myModa3" target="_blank">Sign Up</a></h4>
					<h5>I agree to the <a href="#">Terms & Conditions</a> & <a href="#">Privacy Policy</a></h5>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade st_pop_form_wrapper" id="myModa2" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<div class="st_pop_form_heading_wrapper st_pop_form_heading_wrapper_fpass float_left">
					<h3>Forgot Password</h3>
					<p>We can help! All you need to do is enter your email ID and follow the instructions!</p>
				</div>
				<div class="st_profile_input float_left">
					<label>Email Address</label>
					<input type="text">
				</div>
				<div class="st_form_pop_fpass_btn float_left">	<a href="#">Verify</a>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade st_pop_form_wrapper" id="myModa3" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<div class="st_pop_form_heading_wrapper float_left">
					<h3>Sign Up</h3>
				</div>
				<div class="st_profile_input float_left">
					<label>Email / Mobile Number</label>
					<input type="text">
				</div>
				<div class="st_profile__pass_input st_profile__pass_input_pop float_left">
					<input type="password" placeholder="Password">
				</div>
				<div class="st_form_pop_fp float_left">
					<h3><a href="#" data-toggle="modal" data-target="#myModa2" target="_blank">Forgot Password?</a></h3>
				</div>
				<div class="st_form_pop_login_btn float_left">	<a href="page-1-7_profile_settings.html">LOGIN</a>
				</div>
				<div class="st_form_pop_or_btn float_left">
					<h4>or</h4>
				</div>
				<div class="st_form_pop_facebook_btn float_left">	<a href="#"><i class="fab fa-facebook-f"></i> Connect with Facebook</a>
				</div>
				<div class="st_form_pop_gmail_btn float_left">	<a href="#"><i class="fab fa-google-plus-g"></i> Connect with Google</a>
				</div>
				<div class="st_form_pop_signin_btn st_form_pop_signin_btn_signup float_left">
					<h5>I agree to the <a href="#">Terms & Conditions</a> & <a href="#">Privacy Policy</a></h5>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade st_pop_form_wrapper" id="errorseats" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<div class="st_pop_form_heading_wrapper st_pop_form_heading_wrapper_fpass float_left">
					<h3>error</h3>
					<p style="
    color: #fff;
    background-color: #E53935;
    padding-bottom: 25px;
">you can't have gaps between Seats</p>
				</div>


			</div>
		</div>
	</div>

		<div class="modal fade st_pop_form_wrapper" id="errorseats2" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<div class="st_pop_form_heading_wrapper st_pop_form_heading_wrapper_fpass float_left">
					<h3>error</h3>
					<p style="
    color: #fff;
    background-color: #E53935;
    padding-bottom: 25px;
">you must chose only 6 seats or less </p>
				</div>


			</div>
		</div>
	</div>


	<!-- st login wrapper End -->
	<!--main js file start-->

	<script src="/js/modernizr.js"></script>
	<script src="/js/bootstrap.js"></script>
	<script src="/js/owl.carousel.js"></script>
	<script src="/js/jquery.dlmenu.js"></script>
	<script src="/js/jquery.sticky.js"></script>
	<script src="/js/jquery.nice-select.min.js"></script>
	<script src="/js/jquery.magnific-popup.js"></script>
	<script src="/js/jquery.bxslider.min.js"></script>
	<script src="/js/venobox.min.js"></script>
	<script src="/js/smothscroll_part1.js"></script>
	<script src="/js/smothscroll_part2.js"></script>
	<script src="/js/plugin/rs_slider/jquery.themepunch.revolution.min.js"></script>
	<script src="/js/plugin/rs_slider/jquery.themepunch.tools.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.addon.snow.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.actions.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.carousel.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.kenburn.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.layeranimation.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.migration.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.navigation.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.parallax.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.slideanims.min.js"></script>
	<script src="/js/plugin/rs_slider/revolution.extension.video.min.js"></script>
	<script src="/js/custom.js"></script>
    <!-- CSRF Token -->
    <meta name="csrf-token" content="iO5PXyCSDpZbL4so1wEFAs9WQmf2Fbx8H33HXycX">
	<link rel="stylesheet" type="text/css" href="/css/animate.css" />
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.css" />
	<link rel="stylesheet" type="text/css" href="/css/font-awesome.css" />
	<link rel="stylesheet" type="text/css" href="/css/fonts.css" />
	<link rel="stylesheet" type="text/css" href="/css/flaticon.css" />
	<link rel="stylesheet" type="text/css" href="/css/owl.carousel.css" />
	<link rel="stylesheet" type="text/css" href="/css/owl.theme.default.css" />
	<link rel="stylesheet" type="text/css" href="/css/dl-menu.css" />
	<link rel="stylesheet" type="text/css" href="/css/nice-select.css" />
	<link rel="stylesheet" type="text/css" href="/css/magnific-popup.css" />
	<link rel="stylesheet" type="text/css" href="/css/venobox.css" />
	<link rel="stylesheet" type="text/css" href="/js/plugin/rs_slider/layers.css" />
	<link rel="stylesheet" type="text/css" href="/js/plugin/rs_slider/navigation.css" />
	<link rel="stylesheet" type="text/css" href="/js/plugin/rs_slider/settings.css" />
	<link rel="stylesheet" type="text/css" href="/css/style.css" />
	<link rel="stylesheet" type="text/css" href="/css/responsive.css" />
	<link rel="stylesheet" id="theme-color" type="text/css" href="#"/>
	<!--main js file end-->

	<script>
		//* Isotope js
		    function protfolioIsotope(){
		        if ( $('.st_fb_filter_left_box_wrapper').length ){
		            // Activate isotope in container
		            $(".protfoli_inner, .portfoli_inner").imagesLoaded( function() {
		                $(".protfoli_inner, .portfoli_inner").isotope({
		                    layoutMode: 'masonry',
		                });
		            });

		            // Add isotope click function
		            $(".protfoli_filter li").on('click',function(){
		                $(".protfoli_filter li").removeClass("active");
		                $(this).addClass("active");
		                var selector = $(this).attr("data-filter");
		                $(".protfoli_inner, .portfoli_inner").isotope({
		                    filter: selector,
		                    animationOptions: {
		                        duration: 450,
		                        easing: "linear",
		                        queue: false,
		                    }
		                });
		                return false;
		            });
		        };
		    };
		 protfolioIsotope ();

		  function changeQty(increase) {
				            var qty = parseInt($('.select_number').find("input").val());
				            if (!isNaN(qty)) {
				                qty = increase ? qty + 1 : (qty > 1 ? qty - 1 : 1);
				                $('.select_number').find("input").val(qty);
				            } else {
				                $('.select_number').find("input").val(1);
				            }
				        }


	</script>




	<script type="text/javascript">
	// NB: compatibility with Call Centre & Facebook & Internet Ticketing

////////////////////////////////////////////////////
// GLOBALS
////////////////////////////////////////////////////
var mobilecheck = function () {
    //stolen from http://detectmobilebrowsers.com/mobile
    var check = false;
    (function (a, b) { if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true })(navigator.userAgent || navigator.vendor || window.opera);
    return check;
};

var seatingLoaded = false;

////////////////////////////////////////////////////
// CONSTANTS
////////////////////////////////////////////////////

var EMPTY = 0,       // Available
    SOLD = 1,        // Previously sold
    HOUSE = 2,       // House seat (cannot be sold)
    WHEELCHAIR = 3,     // Special / Wheelchair seat
    SELECTED = 4,    // Selected by user (reserved)
    BROKEN = 5,      // Broken seat (cannot be sold)
    PLACEHOLDER = 6, // Used as a placeholder to help with layout (cannot be sold)
    COMPANION = 7;   // Wheelchair companion seat


////////////////////////////////////////////////////
// CUSTOM SEATING POPUP FUNCTIONALITY
////////////////////////////////////////////////////

var popupTimer;

// Hides the validation popup
function hidePopup(suppressAnimation) {
    if (suppressAnimation) {
        $('.Seating-Popup').hide();
    }
    else {
        $('.Seating-Popup').fadeOut(200);
    }
}

// Shows the validation popup with the given message
function showPopup(message) {
    var seatingPopup = $('.Seating-Popup'),
        page = $(document),
        parentPage = $(parent.document),
        yPosition = 0,
        xPosition = 0,
        opacity = 0.95;

    clearTimeout(popupTimer);

    if (parentPage.length === 1) { // In an iframe
        yPosition = $('.Seating-Theatre').height() * (parentPage.scrollTop() / parentPage.height()); // Offset the popup with the scroll position of the page
    }
    else {
        yPosition = $('.Seating-Theatre').height() * (page.scrollTop() / page.height()); // Offset the popup with the scroll position of the page
    }
    xPosition = seatingPopup.parent().scrollLeft();

    seatingPopup.find('.Seating-PopupMessage').text(message); // Set the message text
    seatingPopup.css('filter', 'alpha(opacity=' + opacity * 100 + ')'); // Fixes IE 8 font problem
    seatingPopup.css('opacity', opacity);

    seatingPopup.fadeIn(200, function () {
        if (seatingPopup.length && seatingPopup[0].tagName === 'TABLE') {
            seatingPopup.css('display', 'table');
        }
        popupTimer = setTimeout(function () { hidePopup(); }, 7000);
    });

    seatingPopup.css('top', yPosition);
    seatingPopup.css('left', xPosition);

    setTimeout(
        function () {
            $('.Seating-PopupMessage').attr('aria-live', 'polite');
            $('.Seating-PopupMessage').attr('aria-label', message);
            $('.Seating-PopupMessage').attr('alt', message);
            $('.Seating-PopupMessage').text(message);
        }, 500);
}

////////////////////////////////////////////////////
// SEAT SELECTION FUNCTINALITY
////////////////////////////////////////////////////

// Turns multi seat select functionality on/off
function setMultiSeatSelect(enabled) {
    m_enableMultiSeatSelect = enabled;
}

// Gets the html 'img' object on the page for a given position by matching its data tags
function getSeatImage(areaNumber, row, col) {
    return $('.Seating-Area[data-area-number=\'' + areaNumber + '\'] img[data-row=\'' + row + '\'][data-col=\'' + col + '\']');
}

// Get the area from the theatre
function getArea(areaNumber) {
    var i = 0;
	var area;
	//console.log(m_theatre.Areas.length);
    for (i = 0; i < m_theatre.Areas.length; i++) {
		//console.log(m_theatre.Areas);
        if (m_theatre.Areas[i].Number === areaNumber) {
			area = m_theatre.Areas[i];
            return m_theatre.Areas[i];
        }
    }

    return null;
}

// Get the seat from the theatre
function getSeat(areaNumber, row, column) {
    var area, seat;

    area = getArea(areaNumber);
	//console.log(area);
	 //seat = area.Rows[row].Seats[column];
     seat = area.Rows[row].Seats[column];

    if (seat) { // Seat was found
        seat.area = area; // Attach a reference to the area to the seat
    }

    return seat;
}

function isSeatStatusAvailable(seatStatus) {
    if (seatStatus === EMPTY) {
        return true;
    }
    else if (m_validationRules.AllowWheelchairSeatPurchase) {

        if (seatStatus === WHEELCHAIR) {
            return true;
        }

        if (seatStatus === COMPANION) {
            return true;
        }
    }
    else if (m_validationRules.RequireWheelchairToPurchaseCompanionSeat) {
        if (seatStatus === COMPANION) {
            return true;
        }
    }
    return false;
}

function seatAvailable(seat) {
    return isSeatStatusAvailable(seat.Status);
}

function isSequentialSeatMode() {
    return m_selectionMode === 'sequential';
}

function isSeatBySeatSeatMode() {
    return m_selectionMode === 'seatbyseat';
}


// Add a seat to the selected seat list
// Note: There is a selected seat list per area category. The selected seat list holds a basic representation
// of each seat that is currently selected.
function addSeatToSelectedList(seat) {
    var seatSelectionObject = { "RowIndex": seat.RowIndex, "ColumnIndex": seat.ColumnIndex, "AreaNumber": seat.area.AreaNumber },
        i = 0;

    for (i = 0; i < m_selectedSeats.length; i++) {
        if (m_selectedSeats[i].AreaCategoryCode === seat.area.AreaCategoryCode) {
            m_selectedSeats[i].Seats.unshift(seatSelectionObject); // Push to front
            return;
        }
    }
}

// Gets the list of selected seats for a given area category code
function getSelectedSeatList(areaCategoryCode) {
    var i = 0;

    for (i = 0; i < m_selectedSeats.length; i++) {
        if (m_selectedSeats[i].AreaCategoryCode === areaCategoryCode) {
            return m_selectedSeats[i].Seats;
        }
    }

    return [];
}

function removeSeatFromSelectedList(seat) {
    var selectedSeats = getSelectedSeatList(seat.area.AreaCategoryCode),
        i = 0;

    for (i = 0; i < selectedSeats.length; i++) {
        if (selectedSeats[i].RowIndex === seat.RowIndex && selectedSeats[i].ColumnIndex === seat.ColumnIndex && selectedSeats[i].AreaNumber === seat.area.AreaNumber) {
            selectedSeats.splice(i, 1); // Remove from selected seats array
            return;
        }
    }
}

function trySelectSeat(seat) {
    var areaNumber = seat.area.AreaNumber;
    var row = seat.RowIndex;
    var col = seat.ColumnIndex;

    var returnValue = {
        messageWarning: "",
        messageError: ""
    };

    // In sequential mode, deselect the oldest picked seat (including all adjacent selected seats for multi-select mode)
    if (m_selectionMode === 'sequential') {
        var selectedSeats = getSelectedSeatList(seat.area.AreaCategoryCode);
        if (selectedSeats.length === m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsToAllocate) {
            var oldestPickedSeat = getSeat(selectedSeats[selectedSeats.length - 1].AreaNumber, selectedSeats[selectedSeats.length - 1].RowIndex, selectedSeats[selectedSeats.length - 1].ColumnIndex);
            var seatsToDeselect = [oldestPickedSeat];

            // If multi select is enabled, also remove all adjacent selected seats.
            if (m_enableMultiSeatSelect) {
                var adjacentSelectedSeats = getSeatsContiguousFromSeat(oldestPickedSeat, SELECTED, false);
                for (var i = 0; i < adjacentSelectedSeats.length; i++) {
                    seatsToDeselect.push(adjacentSelectedSeats[i]);
                }
            }

            for (var i = 0; i < seatsToDeselect.length; i++) {
                var seatToDeselect = seatsToDeselect[i];
                var wheelchairStatus = deselectCompanionSeatsIfRequired(seatToDeselect);
                deselectSeat(seatToDeselect.area.AreaNumber, seatToDeselect.RowIndex, seatToDeselect.ColumnIndex);

                if (wheelchairStatus.failedCheck) {
                    returnValue.messageError = wheelchairStatus.message;
                    return returnValue
                }
                returnValue.messageWarning = wheelchairStatus.message;
            }
        }
    }

    if (seat.Status === WHEELCHAIR) {
        returnValue.messageWarning = m_validationRules.WheelChairSelected;
    }
    else if (isCompanionSeat(seat)) {
        var hasAssociatedWheelchair = checkForMatchingWheelchair(seat);
        if (!hasAssociatedWheelchair) {

            if (m_validationRules.RequireWheelchairToPurchaseCompanionSeat == "False") {
                if (m_validationRules.WarnCompanionSeatWithoutWheelchairSeat) {
                    returnValue.messageWarning = m_validationRules.WarnCompanionSeatWithoutWheelchairSeat;
                }
                else {
                    returnValue.messageWarning = "";
                }
            }
            else {
                returnValue.messageError = m_validationRules.RequireWheelchairToPurchaseCompanionSeat;
                return returnValue
            }
        }
    }

    selectSeat(areaNumber, row, col);

    return returnValue;
}

function selectSeat(areaNumber, row, col) {
    var seat = getSeat(areaNumber, row, col);
    if (m_enableMultiSeatSelect) {
        selectSeatMulti(seat);
    }
    else {
        selectSeatSingle(seat);
    }
}

function selectSeatMulti(seat) {
    if (seat.Status === WHEELCHAIR) {
        // For wheelchair seats, we bypass the regular multi-select process.
        // Instead, we select the wheelchair with as many companion seats as we can (in their defined order)
        selectSeatSingle(seat);

        var seatsAvailableToAllocate = m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsNotAllocatedCount;
        var emptyCompanionSeats = associatedCompanionSeats(seat, [EMPTY, COMPANION]);
        var companionSeatsToAllocate = Math.min(seatsAvailableToAllocate, emptyCompanionSeats.length);
        for (var i = 0; i < companionSeatsToAllocate; i++) {
            selectSeatSingle(emptyCompanionSeats[i]);
        }
    }
    else {
        selectSeatsInDirectionFromSeat(seat, 'left');
        selectSeatsInDirectionFromSeat(seat, 'right');
    }

}

function selectSeatsInDirectionFromSeat(seat, direction) {
    var seatsMaxToAllocate = m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsNotAllocatedCount;
    var seatsRemainingToAllocate = m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsNotAllocatedCount;
    var willSelectInputSeat = seatAvailable(seat);//seat.Status === EMPTY || (isCompanionSeat(seat) && seat.Status !== SELECTED;

    var step = (direction === 'left' ? 1 : -1);
    var startI = (willSelectInputSeat ? 0 : step);
    var endI = (willSelectInputSeat ? seatsMaxToAllocate - 1 : seatsMaxToAllocate);

    for (var i = startI; Math.abs(i) <= endI; i += step) {
        var currentSeat = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + i);

        // Stop traversal if:
        // 1: no seat found
        if (!currentSeat) {
            break;
        }
        // 2: we find a seat that is not empty, selected, or companion
        if ($.inArray(currentSeat.Status, [EMPTY, SELECTED, COMPANION]) === -1) {
            break;
        }
        // 3: a non empty seat was found that wasn't the clicked seat
        if (currentSeat.Status !== EMPTY && i !== 0) {
            break;
        }

        selectSeatSingle(currentSeat);
        seatsRemainingToAllocate--;
    }
}

function selectSeatSingle(seat) {
    var seatImage = getSeatImage(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex);

    m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsNotAllocatedCount -= 1; // Reduce the number of available seats

    seat.Status = SELECTED;

    // Change to the reserved image
    var re = /[a-zA-Z]*_available/i,
        replaceWith = null;

    if (seat.OriginalSeatStatus === EMPTY || seat.OriginalSeatStatus === SELECTED) {
        seatImage.attr('src', seatImage.attr('src').replace('_available', '_selected'));
    }
    else if (seat.OriginalSeatStatus === WHEELCHAIR) {
        replaceWith = 'wheelchair_selected';
        seatImage.attr('src', seatImage.attr('src').replace(re, replaceWith));
    }
    else if (seat.IsCompanion) {
        replaceWith = 'companion_selected';
        seatImage.attr('src', seatImage.attr('src').replace(re, replaceWith));
    }


    addSeatToSelectedList(seat);
}

function isCompanionSeat(seat) {
    if (m_validationRules.CreateLegacyCompanionSeats) {
        return isLegacyCompanionSeat(seat);
    }
    return seat.IsCompanion;
}

function isLegacyCompanionSeat(seat) {
    var seatToLeft = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 1);
    var seatToRight = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 1);

    if (seatToLeft && seatToLeft.OriginalSeatStatus === WHEELCHAIR) {
        return true;
    }
    if (seatToRight && seatToRight.OriginalSeatStatus === WHEELCHAIR) {
        return true;
    }
    return false;
}

function deselectSeat(areaNumber, row, col) {
    if (m_enableMultiSeatSelect) {
        deselectSeatMulti(areaNumber, row, col);
    } else {
        deselectSeatSingle(areaNumber, row, col);
    }
}

function deselectSeatMulti(areaNumber, row, col) {
    var seat = getSeat(areaNumber, row, col);
    if (seat) {
        var seatsToDeselect = getSeatsContiguousFromSeat(seat, SELECTED, true);
        for (var i = 0; i < seatsToDeselect.length; i++) {
            var seatToDeselect = seatsToDeselect[i];
            deselectSeatSingle(seatToDeselect.area.AreaNumber, seatToDeselect.RowIndex, seatToDeselect.ColumnIndex);
        }
    }
}

// Deselects a specific seat
function deselectSeatSingle(areaNumber, row, col) {
    var seat = getSeat(areaNumber, row, col),
        seatImage = getSeatImage(areaNumber, row, col);

    if (seat.Status !== SELECTED) {
        return;
    }

    m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsNotAllocatedCount += 1; // Increase the number of available seats for this area category

    var re = /[a-zA-Z]*_selected/i;
    if (seat.OriginalSeatStatus === EMPTY || seat.OriginalSeatStatus === SELECTED) {
        seatImage.attr('src', seatImage.attr('src').replace('_selected', '_available')); // Change to the empty image TODO: Revisit how changing images works
        seat.Status = EMPTY;
    }
    else if (seat.OriginalSeatStatus === WHEELCHAIR) {
        seatImage.attr('src', seatImage.attr('src').replace(re, 'wheelchair_available'));
        seat.Status = WHEELCHAIR;
    }
    else if (seat.IsCompanion) {
        seatImage.attr('src', seatImage.attr('src').replace(re, 'companion_available'));
        seat.Status = COMPANION;
    }

    removeSeatFromSelectedList(seat);
}


/**
 * Deselects all seats in the group in which seatInGroup is located.
 * @param {} seat
 */
function deselectGroup(seat) {

    var seatsDeselected = 0, groupSeat, idx;

    if (seat && seat.SeatsInGroup) {

        for (idx = 0; idx < seat.SeatsInGroup.length; idx++) {
            groupSeat = getSeat(seat.area.AreaNumber, seat.SeatsInGroup[idx].RowIndex, seat.SeatsInGroup[idx].ColumnIndex);
            if (groupSeat.Status === SELECTED) {
                deselectSeat(seat.area.AreaNumber, groupSeat.RowIndex, groupSeat.ColumnIndex);
                seatsDeselected++;
            }
        }
    }

    return { deselectedCount: seatsDeselected };
}

function areInSamePosition(seatA, seatB) {
    return seatA && seatB && seatA.RowIndex === seatB.RowIndex && seatA.ColumnIndex === seatB.ColumnIndex;
}

// Deselects the currently selected seat which is furthest from the chosen seat
function deselectFurthestSeat(areaNumber, row, col) {
    var area = getArea(areaNumber),
        selectedSeats = getSelectedSeatList(area.AreaCategoryCode),
        i,
        furthestSeatSoFar;

    for (i = 0; i < selectedSeats.length; i++) {
        if (!furthestSeatSoFar) { // No seat chosen yet
            furthestSeatSoFar = selectedSeats[i];
            continue;
        }

        if (selectedSeats[i].AreaNumber !== areaNumber) { // Area number takes precedence
            furthestSeatSoFar = selectedSeats[i];
            break;
        }
        else if (Math.abs(selectedSeats[i].RowIndex - row) > Math.abs(furthestSeatSoFar.RowIndex - row)) { // Row difference takes precedence over column difference
            furthestSeatSoFar = selectedSeats[i];
        }
        else if (Math.abs(selectedSeats[i].RowIndex - row) === Math.abs(furthestSeatSoFar.RowIndex - row) &&
            Math.abs(selectedSeats[i].ColumnIndex - col) > Math.abs(furthestSeatSoFar.ColumnIndex - col)) {
            furthestSeatSoFar = selectedSeats[i];
        }
    }

    deselectSeat(furthestSeatSoFar.AreaNumber, furthestSeatSoFar.RowIndex, furthestSeatSoFar.ColumnIndex);
}

// Selects as many seats as available in the sofa that this seat belongs to
function selectSofa(seat, numberToAllocate) {
    var i,
        sofaSeat,
        seatsToLeft = 0,
        seatsToRight = 0,
        soldSeatsToLeft = 0,
        soldSeatsToRight = 0,
        sofaIsEmpty = true,
        allocateFromRight = true;

    // Work out how many seats are to the left and right of the chosen seat on the sofa - assuming IDs are ordered with higher to the right
    for (i = 0; i < seat.SeatsInGroup.length; i++) {
        sofaSeat = getSeat(seat.area.AreaNumber, seat.SeatsInGroup[i].RowIndex, seat.SeatsInGroup[i].ColumnIndex);

        if (!seatAvailable(sofaSeat)) {
            sofaIsEmpty = false;

            if (sofaSeat.ColumnIndex > seat.ColumnIndex) { // Seat indices go from right to left
                soldSeatsToLeft++;
            }
            else if (sofaSeat.ColumnIndex < seat.ColumnIndex) {
                soldSeatsToRight++;
            }
        }

        if (sofaSeat.ColumnIndex > seat.ColumnIndex) {
            seatsToLeft++;
        }
        else if (sofaSeat.ColumnIndex < seat.ColumnIndex) {
            seatsToRight++;
        }
    }

    if (sofaIsEmpty) {
        if (seatsToLeft < seatsToRight) { // Seat is on the left side of the sofa - Allocate from left
            allocateFromRight = false;
        }
    }
    else { // Sofa has other seats allocated
        if (soldSeatsToLeft > soldSeatsToRight) { // There are more sold seats on the left - Allocate from left
            allocateFromRight = false;
        }
    }

    if (allocateFromRight) {
        for (i = 0; i < seat.SeatsInGroup.length && numberToAllocate !== 0; i++) {
            sofaSeat = getSeat(seat.area.AreaNumber, seat.SeatsInGroup[i].RowIndex, seat.SeatsInGroup[i].ColumnIndex);

            if (seatAvailable(sofaSeat)) {
                selectSeatSingle(sofaSeat);
                numberToAllocate--;
            }
        }
    }
    else {
        for (i = seat.SeatsInGroup.length - 1; i >= 0 && numberToAllocate !== 0; i--) {
            sofaSeat = getSeat(seat.area.AreaNumber, seat.SeatsInGroup[i].RowIndex, seat.SeatsInGroup[i].ColumnIndex);

            if (seatAvailable(sofaSeat)) {
                selectSeatSingle(sofaSeat);
                numberToAllocate--;
            }
        }
    }
}


// Gets the number of seats available in the sofa that the seat is part of
function getNumAvailableSeatsInSofa(seat) {
    var i,
        seatsAvailable = 0;

    for (i = 0; i < seat.SeatsInGroup.length; i++) {
        var sofaSeat = getSeat(seat.area.AreaNumber, seat.SeatsInGroup[i].RowIndex, seat.SeatsInGroup[i].ColumnIndex);

        if (seatAvailable(seat)) {
            seatsAvailable++;
        }
    }

    return seatsAvailable;
}

// Deselects all seats in the given area category
function deselectAllSeats(areaCategoryCode) {
    var i,
        selectedSeats = getSelectedSeatList(areaCategoryCode).slice(); // Take a copy of this array as 'deselectSeat' edits this array directly which would break the for loop

    for (i = 0; i < selectedSeats.length; i++) {
        deselectSeat(selectedSeats[i].AreaNumber, selectedSeats[i].RowIndex, selectedSeats[i].ColumnIndex);
    }
}

// Deselects a specific number of seats in an area category
// If the seat passed as a parameter is on a sofa then don't deselect seats on the same sofa
function deselectSeats(seat, seatsToDeselect) {
    var i,
        selectedSeats = getSelectedSeatList(seat.area.AreaCategoryCode).slice(); // Take a copy of this array as 'deselectSeat' edits this array directly which would break the for loop

    if (selectedSeats.length === 0) {
        return;
    }

    if (seatsToDeselect >= selectedSeats.length) {
        deselectAllSeats(seat.area.AreaCategoryCode);
    }
    else {
        for (i = 0; i < seatsToDeselect; i++) {
            deselectFurthestSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex);
        }
    }
}

// This function is called by the area clicked event
function seatClicked(seatImage, areaNumber) {

    //If we are in read only mode then don't do anything here
    if (m_isReadOnlyMode) {
        return;
    }

    var seat = getSeat(areaNumber, seatImage.data('row'), seatImage.data('col')),
        message = '';

    if (!seat) { // Place holder seat
        return;
    }

    if (m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsToAllocate === 0) { // No seats available in this area category
        return m_validationRules.InvalidAreaSelected;
    }
    else if (seatAvailable(seat)) {
        var seatsRemaining = m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsNotAllocatedCount;

        if (seatsRemaining === 0) { // No seats left in this area category
            if (m_selectionMode === 'seatbyseat') {
                return m_validationRules.AllSeatsAllocated;
            }
        }

        if (seat.IsSofaSeat && m_sofaSeatingEnabled) { // Seat is in a sofa

            var seatsAvailable;

            // In seat-first mode with partial selection allowed, sofa seats must be selected one at a time
            // Otherwise there is no easy way for the user to select less than the total number seats in the sofa
            var seatsToSelect;

            if (m_selectionMode === 'seatbyseat') {
                var nSeatsAvailableInSofaBeforeSelection = getNumAvailableSeatsInSofa(seat);
                seatsAvailable = m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsNotAllocatedCount;

                seatsToSelect = seatsAvailable;
                if (SeatingControl.isSeatFirst() && !m_validationRules.MustFillSofa)
                    seatsToSelect = Math.min(seatsAvailable, 1);

                selectSofa(seat, seatsToSelect);

                // Check whether the whole sofa can be selected with the seats available in this area category
                if (seatsAvailable < nSeatsAvailableInSofaBeforeSelection) { // Can't select whole sofa
                    if (m_validationRules.MustFillSofa) {
                        // only set message if more than 1 available seat left in row (excluding what we're trying to select)
                        var mustFillSofaValidationRule = getActiveValidationRule("MustFillSofa");
                        if (mustFillSofaValidationRule && !mustFillSofaValidationRule.validate(seat)) {
                            message = m_validationRules.MustFillSofa;
                        }
                    }
                }
            }
            else if (m_selectionMode === 'sequential') {
                deselectGroup(seat); // The user may already have selected seats on this sofa

                seatsRemaining = m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsNotAllocatedCount;
                seatsAvailable = m_theatre.AreaCategories[seat.area.AreaCategoryCode].SeatsToAllocate;

                var seatsAvailableInSofa = getNumAvailableSeatsInSofa(seat);

                // Check whether the whole sofa can be selected with the seats available in this area category
                if (seatsAvailable < seatsAvailableInSofa) { // Can't select whole sofa
                    if (m_validationRules.MustFillSofa) {
                        return m_validationRules.MustFillSofa;
                    }
                }

                if (seatsAvailableInSofa - seatsRemaining > 0) {
                    deselectSeats(seat, seatsAvailableInSofa - seatsRemaining); // Deselect as many seats as needed to fill the sofa
                }

                selectSofa(seat, Math.min(seatsAvailableInSofa, seatsAvailable));
            }
        }
        else { // Standard seat
            var selectSeatResult = trySelectSeat(seat);
            if (selectSeatResult.messageError !== undefined && selectSeatResult.messageError.length > 0) {
                return selectSeatResult.messageError;
            } else if (selectSeatResult.messageWarning.length > 0) {
                message = selectSeatResult.messageWarning;
            }
        }
    }
    else if (seat.Status === SELECTED) { // The seat is already selected
        if (m_selectionMode === 'sequential') {
            return; // Deselection isn't available in sequential movement mode
        }

        if (seat.OriginalSeatStatus === WHEELCHAIR) {

            var deselectedWheelchairStatus = deselectCompanionSeatsIfRequired(seat);
            if (deselectedWheelchairStatus.failedCheck) {
                return deselectedWheelchairStatus.message;
            }
            message = deselectedWheelchairStatus.message;
        }
        else if (seat.IsSofaSeat && m_sofaSeatingEnabled) { // Seat is in a sofa
            deselectGroup(seat); // Deselect whole sofa
        }
        else { // Standard seat
            deselectSeat(areaNumber, seatImage.data('row'), seatImage.data('col'));
        }
    }
    else {
        return m_validationRules.InvalidSeatSelected;
    }

    // If the user is selecting a sales server allocated seat then don't show a validation warning
    if (seat.OriginalSeatStatus === SELECTED) {
        message = '';
    }

    return message;
}

function deselectCompanionSeatsIfRequired(seat) {

    var message = '',
        wasWheelchair = seat.OriginalSeatStatus === WHEELCHAIR,
        failedCheck = false;

    if (seat.OriginalSeatStatus === WHEELCHAIR) {
        var companions = associatedCompanionSeats(seat, [SELECTED]);

        var companionSeatsSelected = companions.length > 0;
        // Deselect all companions in multi-select mode without warnings. In single seat select mode, show the warning
        if (m_enableMultiSeatSelect || (m_validationRules.RequireWheelchairToPurchaseCompanionSeat && m_validationRules.RequireWheelchairToPurchaseCompanionSeat !== "False")) {
            failedCheck = companionSeatsSelected && !m_enableMultiSeatSelect;
            deselectSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex);
            for (var i = 0; i < companions.length; i++) {
                var companionSeat = companions[i];
                deselectSeat(companionSeat.area.AreaNumber, companionSeat.RowIndex, companionSeat.ColumnIndex);
            }
            if (companionSeatsSelected && !m_enableMultiSeatSelect) {
                message = m_validationRules.WarnCompanionSeatsRemovedWithWheelchair;
            }
        }
        else {
            // Deselect wheelchair, but do not deselect matching companion seats.
            deselectSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex);
            if (companionSeatsSelected && m_validationRules.WarnCompanionSeatWithoutWheelchairSeat) {
                message = m_validationRules.WarnCompanionSeatWithoutWheelchairSeat;
            }
        }
    }

    return {
        message: message,
        wasWheelChair: wasWheelchair,
        failedCheck: failedCheck
    }
}

////////////////////////////////////////////////////
// VALIDATION FUNCTINALITY
////////////////////////////////////////////////////

// Object to encapsulate a seating rule with a validation method and message to display upon failure
function SeatRule(msg, validationMethod, id) {
    this.message = msg;
    this.validate = validationMethod;
    this.id = id;
}

// Indicates which seat is causing the seating error TODO: Enable/disable this based on a setting on the control?
//function flashSeat(seat) {
//    getSeatImage(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex).effect('highlight', { color: '#FF0000' }, 1000);
//}

//function flashSofa(seat) {
//    var sofaSeat;

//    for (i = 0; i < seat.SeatsInGroup.length; i++) {
//        sofaSeat = getSeatById(seat.area, seat.RowIndex, seat.SeatsInGroup[i]);

//        flashSeat(sofaSeat);
//    }
//}

// Checks for a gap seat next to a selected seat and then for a selected seat on the other side of the gap
function checkSingleSeatBetweenSeats(seat) {

    // If we are ignoring special seats then we need to
    // skip validation if the seat in question is special.
    if (m_validationRules.SpecialSeatsIgnoreLogic) {
        if (seat.OriginalSeatStatus === WHEELCHAIR) {
            return true;
        }
    }

    var oneSeatOver, twoSeatsOver;

    // Check to the left
    if (seat.ColumnIndex + 2 < seat.area.ColumnCount) { // Check row bounds
        oneSeatOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 1);

        if (oneSeatOver && seatAvailable(oneSeatOver)) {
            twoSeatsOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 2);

            if (twoSeatsOver) {
                if (twoSeatsOver.Status === SELECTED) {
                    //flashSeat(oneSeatOver);
                    return false;
                }
            }
        }
    }

    // Check to the right
    if (seat.ColumnIndex - 2 > -1) {
        oneSeatOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 1);

        if (oneSeatOver && seatAvailable(oneSeatOver)) {
            twoSeatsOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 2);

            if (twoSeatsOver) {
                if (twoSeatsOver.Status === SELECTED) {
                    //flashSeat(oneSeatOver);
                    return false;
                }
            }
        }
    }

    return true;
}

// Ensure that a single seat gap isn't left between selected seats and the aisle
function checkSingleSeatGapFromAisle(seat) {

    // If we are ignoring special seats then we need to
    // skip validation if the seat in question is special.
    if (m_validationRules.SpecialSeatsIgnoreLogic) {
        if (seat.OriginalSeatStatus === WHEELCHAIR) {
            return true;
        }
    }

    var oneSeatOver, oneSeatOtherWay;

    // Check if aisle to the left
    if (seat.ColumnIndex + 1 < seat.area.ColumnCount) { // Check row bounds
        oneSeatOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 1);

        if (oneSeatOver && seatAvailable(oneSeatOver)) {
            if (seat.ColumnIndex + 2 === seat.area.ColumnCount || !getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 2)) {
                oneSeatOtherWay = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 1);
                // if the seat to the right is already taken, then it is valid
                if (oneSeatOtherWay && (seatAvailable(oneSeatOtherWay) && oneSeatOtherWay.Status !== SELECTED)) {
                    if (ignoreSeatGapIfNoAdequateSpaceLeftInRow(seat.area.Rows[seat.RowIndex])) {
                        return true;
                    }
                    return false;
                }
            }
        }
    }

    // Check if aisle to the right
    if (seat.ColumnIndex - 1 > -1) { // Check row bounds
        oneSeatOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 1);

        if (oneSeatOver && seatAvailable(oneSeatOver)) {
            if (seat.ColumnIndex - 2 === seat.area.ColumnCount || !getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 2)) {
                //flashSeat(oneSeatOver);
                oneSeatOtherWay = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 1);
                if (oneSeatOtherWay && (seatAvailable(oneSeatOtherWay) && oneSeatOtherWay.Status !== SELECTED)) {
                    if (ignoreSeatGapIfNoAdequateSpaceLeftInRow(seat.area.Rows[seat.RowIndex])) {
                        return true;
                    }
                    return false;
                }
            }
        }
    }

    return true;
}

// Ensure that a single seat isn't left between selected seats and other sold seats
function checkSingleSeatGapFromSoldSeats(seat) {

    // If we are ignoring special seats then we need to
    // skip validation if the seat in question is special.
    if (m_validationRules.SpecialSeatsIgnoreLogic) {
        if (seat.OriginalSeatStatus === WHEELCHAIR) {
            return true;
        }
    }

    var oneSeatOver, twoSeatsOver;

    // Check to the left
    if (seat.ColumnIndex + 2 < seat.area.ColumnCount) { // Check row bounds
        oneSeatOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 1);

        if (oneSeatOver && seatAvailable(oneSeatOver)) {
            twoSeatsOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 2);

            if (twoSeatsOver) {
                if (twoSeatsOver.Status === SOLD) {
                    //flashSeat(oneSeatOver);
                    if (ignoreSeatGapIfNoAdequateSpaceLeftInRow(seat.area.Rows[seat.RowIndex])) {
                        return true;
                    }
                    return false;
                }
            }
        }
    }

    // Check to the right
    if (seat.ColumnIndex - 2 > -1) {
        oneSeatOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 1);

        if (oneSeatOver && seatAvailable(oneSeatOver)) { // Gap seat
            twoSeatsOver = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 2);

            if (twoSeatsOver) {
                if (twoSeatsOver.Status === SOLD) {
                    //flashSeat(oneSeatOver);
                    if (ignoreSeatGapIfNoAdequateSpaceLeftInRow(seat.area.Rows[seat.RowIndex])) {
                        return true;
                    }
                    return false;
                }
            }
        }
    }

    return true;
}

// Ensure all sofas with allocated seats on them are full
function checkSofaFull(seat) {
    var i, sofaSeat;

    if (seat.IsSofaSeat && m_sofaSeatingEnabled) { // Seat is in a sofa
        for (i = 0; i < seat.SeatsInGroup.length; i++) {
            sofaSeat = getSeat(seat.area.AreaNumber, seat.SeatsInGroup[i].RowIndex, seat.SeatsInGroup[i].ColumnIndex);

            if (seatAvailable(sofaSeat)) {
                //flashSofa(seat);
                // Allow the seat to be selected if it would leave a single gap in the row (will occur when session fills up)
                if (ignoreSeatGapIfNoAdequateSpaceLeftInRow(seat.area.Rows[seat.RowIndex])) {
                    return true;
                }
                return false; // Ensure the whole sofa is reserved / sold
            }
        }
    }

    return true;
}

function checkForMatchingWheelchair(companionSeat) {

    if (companionSeat.IsCompanion && companionSeat.SeatsInGroup) {
        return checkForWheelchairSeatInGroup(companionSeat);
    }
    // CLIENTS OF LEGACY SALES SERVER INSTANCES ONLY
    // To be removed when all customers support the new Sales Server
    // companion seating constructs
    else if (m_validationRules.CreateLegacyCompanionSeats) {
        return checkForAdjacentWheelchairSeat(companionSeat);
    }

    return true;
}

/**
 * Should be used when companion seat information is returned from Sales Server.
 * If companion seat info is NOT available use checkForAdjacentWheelchairSeat(seat)
 * @param {} companion
 * @returns {} false if a wheelchair has not been selected for this companion seat
 */
function checkForWheelchairSeatInGroup(companion) {

    // Find any selected wheelchair seat with this companion seat in its group
    var selectedSeats = getSelectedSeatList(companion.area.AreaCategoryCode), selectedSeat, i, j;

    for (i = 0; i < selectedSeats.length; i++) {
        selectedSeat = getSeat(selectedSeats[i].AreaNumber, selectedSeats[i].RowIndex, selectedSeats[i].ColumnIndex);

        if (selectedSeat.OriginalSeatStatus === WHEELCHAIR && selectedSeat.SeatsInGroup) {

            for (j = 0; j < selectedSeat.SeatsInGroup.length; j++) {

                if (areInSamePosition(companion, selectedSeat.SeatsInGroup[j])) {
                    return true;
                }
            }
        }
    }
    return false;
}


/**
 * LEGACY Should be used only when companion seat information is not returned from Sales Server.
 * If companion seat is available, use checkCompanionSeats(seat) instead.
 * @param {} companion
 * @returns {} false if a wheelchair has not been selected for this companion seat
 */
function checkForAdjacentWheelchairSeat(companion) {

    var seatToLeft = getSeat(companion.area.AreaNumber, companion.RowIndex, companion.ColumnIndex + 1);
    var seatToRight = getSeat(companion.area.AreaNumber, companion.RowIndex, companion.ColumnIndex - 1);

    if (seatToLeft && seatToLeft.Status === WHEELCHAIR) {
        return false;
    }
    else if (seatToRight && seatToRight.Status === WHEELCHAIR) {
        return false;
    }
    return true;
}


function associatedCompanionSeats(wheelchairSeat, statusArray) {

    var companionSeats = [];

    if (wheelchairSeat.OriginalSeatStatus !== WHEELCHAIR) {
        return companionSeats;
    }

    // CLIENTS OF LEGACY SALES SERVER INSTANCES ONLY
    // To be removed when all customers support the new Sales Server
    // companion seating constructs
    if (wheelchairSeat.SeatsInGroup) {
        var wheelchairGroup = wheelchairSeat.SeatsInGroup || [], seat;
        for (var i = 0; i < wheelchairGroup.length; i++) {
            seat = getSeat(wheelchairSeat.area.AreaNumber, wheelchairGroup[i].RowIndex, wheelchairGroup[i].ColumnIndex);
            if (seat.IsCompanion && $.inArray(seat.Status, statusArray) !== -1) {
                companionSeats.push(seat);
            }
        }
    } else if (m_validationRules.CreateLegacyCompanionSeats) {

        var seatToLeft = getSeat(wheelchairSeat.area.AreaNumber, wheelchairSeat.RowIndex, wheelchairSeat.ColumnIndex + 1);
        var seatToRight = getSeat(wheelchairSeat.area.AreaNumber, wheelchairSeat.RowIndex, wheelchairSeat.ColumnIndex - 1);

        if (seatToLeft && $.inArray(seatToLeft.Status, statusArray) !== -1) {
            companionSeats.push(seatToLeft);
        }
        else if (seatToRight && $.inArray(seatToRight.Status, statusArray) !== -1) {
            companionSeats.push(seatToRight);
        }
    }

    return companionSeats;
}

// TODO: Re-visit how this works and make it clearer for the next person
function getActiveValidationRules() {
    var validationRules = [];

    if (m_validationRules.SingleSeatBetweenSeats) {
        validationRules.push(new SeatRule(m_validationRules.SingleSeatBetweenSeats, checkSingleSeatBetweenSeats, "SingleSeatBetweenSeats"));
    }

    if (m_validationRules.SingleSeatGapFromAisle) {
        validationRules.push(new SeatRule(m_validationRules.SingleSeatGapFromAisle, checkSingleSeatGapFromAisle, "SingleSeatGapFromAisle"));
    }

    if (m_validationRules.SingleSeatGapFromSoldSeats) {
        validationRules.push(new SeatRule(m_validationRules.SingleSeatGapFromSoldSeats, checkSingleSeatGapFromSoldSeats, "SingleSeatGapFromSoldSeats"));
    }

    if (m_validationRules.MustFillSofa) {
        validationRules.push(new SeatRule(m_validationRules.MustFillSofa, checkSofaFull, "MustFillSofa"));
    }

    if (m_validationRules.RequireWheelchairToPurchaseCompanionSeat && m_validationRules.RequireWheelchairToPurchaseCompanionSeat != "False") {
        validationRules.push(new SeatRule(m_validationRules.RequireWheelchairToPurchaseCompanionSeat, checkForMatchingWheelchair, "RequireWheelchairToPurchaseCompanionSeat"));
    }

    return validationRules;
}

function getActiveValidationRule(id) {
    var validationRules = getActiveValidationRules();
    for (var i = 0; i < validationRules.length; i++) {
        if (validationRules[i].id === id) {
            return validationRules[i];
        }
    }
}

// When validation passes this function fills a field on the page with the selected seats string
function setSelectedSeatsField(isTemp) {
    var hiddenField = $('#' + m_hiddenFieldId),
        seat,
        selectedSeatsData = '',
        selectedSeatCount = 0,
        i;

    if (isTemp) {
        //Hidden field for storing seat data, will need to be created on page
        hiddenField = $('#txtSeatSelectionTemp');
    }

    // Create the selected seats string to pass back to the server
    for (i = 0; i < m_selectedSeats.length; i++) {
        for (j = 0; j < m_selectedSeats[i].Seats.length; j++) {
            seat = m_selectedSeats[i].Seats[j];

            selectedSeatsData += m_selectedSeats[i].AreaCategoryCode + '|' + seat.AreaNumber + '|' + (seat.RowIndex + 1) + '|' + (seat.ColumnIndex + 1) + '|';

            selectedSeatCount += 1;
        }
    }

    // Set the hidden fields value
    hiddenField.val('|' + selectedSeatCount + '|' + selectedSeatsData);
}

// Called by the page when the validate button is clicked
function validateSeating() {
    var seatsHaveChanged = false,
        validationRules = getActiveValidationRules(), // Get the current rules
        anyValidationRulesTriggeredForPreAllocatedSeats,
        i, j, k, seat, result;

    anyValidationRulesTriggeredForPreAllocatedSeats =
        m_validationRulesForceValidationOfPreSelectedSeats !== undefined &&
        m_validationRulesForceValidationOfPreSelectedSeats.length > 0;

    // Seat selection not required for unallocated areas
    if (SeatingControl.isSeatFirst() && SeatingControl.isSeatSelectionRequired() && !SeatingControl.hasSelectedSeats()) {
        showPopup(m_validationRules.AllSeatsInOrderMustBeSelected); // TODO: different validation message?
        return false;
    }


    //Special case for seat first & ticket package
    if (SeatingControl.isSeatFirst()) {
        var seatCountText = $('#txtAreaDefaultTicketSeatCounts').val();
        var areaSeatCount = [];
        if (seatCountText !== "") {
            areaSeatCount = parseSeatCountData(seatCountText);
        }
        var selectedSeats = this.getSelectedSeats();

        var defaultSeatCount = getDefaultSeatCountForArea(selectedSeats[0].area.AreaNumber, areaSeatCount);

        if (defaultSeatCount > 0 && (selectedSeats.length % defaultSeatCount !== 0)) {
            showPopup(m_validationRules.ValidationMultipleNumberOfSeats + defaultSeatCount);
            return false;
        }
    }

    // Check whether seating has been changed at all by the user
    for (i = 0; i < m_selectedSeats.length; i++) {
        // Check if there are seats remaining for allocation
        // Seat-first does not require all seats selected
        if (!SeatingControl.isSeatFirst() && m_theatre.AreaCategories[m_selectedSeats[i].AreaCategoryCode].SeatsNotAllocatedCount > 0) {
            showPopup(m_validationRules.AllSeatsInOrderMustBeSelected);
            return false;
        }

        for (j = 0; j < m_selectedSeats[i].Seats.length; j++) {
            seat = getSeat(m_selectedSeats[i].Seats[j].AreaNumber, m_selectedSeats[i].Seats[j].RowIndex, m_selectedSeats[i].Seats[j].ColumnIndex);

            if (seat.OriginalSeatStatus !== seat.Status) { // Seating has changed
                seatsHaveChanged = true;
            }
        }
    }

    // Only need to do validation checks if seats have been changed
    // Unless we have any validation rules set up to run against pre-selected seats, run those (and only those) validation checks here
    if (seatsHaveChanged || anyValidationRulesTriggeredForPreAllocatedSeats) {
        for (i = 0; i < m_selectedSeats.length; i++) {
            for (j = 0; j < m_selectedSeats[i].Seats.length; j++) {
                // Check the current seat against each of the current validation rules
                for (k = 0; k < validationRules.length; k++) {
                    // Only process configured validation rules if the seats haven't changed
                    if (!seatsHaveChanged && m_validationRulesForceValidationOfPreSelectedSeats.indexOf(validationRules[k].id) < 0) {
                        continue;
                    }
                    seat = getSeat(m_selectedSeats[i].Seats[j].AreaNumber, m_selectedSeats[i].Seats[j].RowIndex, m_selectedSeats[i].Seats[j].ColumnIndex);

                    result = validationRules[k].validate(seat);

                    if (result === false) { // Validation failed
                        showPopup(validationRules[k].message);
                        return false;
                    }
                }
            }
        }

        // One-time validation against all seats, so not added as a validation rule
        if (m_validationRules.MustFillSofa !== undefined && !m_validationRules.MustFillSofa && !SeatingControl.checkOnlyOnePartiallyFilledSofa()) {
            showPopup(m_validationRules.SinglePartiallyFilledSofa);
            return false;
        }
    }

    setSelectedSeatsField();

    return true; // Validation passed
}

function parseSeatCountData(seatCount) {
    var areas = seatCount.split('++');
    areas.pop();
    var areaSeatCount = [];
    for (var i = 0; i < areas.length; i++) {
        var countData = areas[i].split('-');
        areaSeatCount.push({ areaNumber: parseInt(countData[0]), defaultSeatCount: parseInt(countData[1]) });
    }
    return areaSeatCount;
}

function getDefaultSeatCountForArea(areaNumber, areaSeatCount) {
    for (var i = 0; i < areaSeatCount.length; i++) {
        if (areaSeatCount[i].areaNumber === areaNumber) {
            return areaSeatCount[i].defaultSeatCount;
        }
    }
    return 0;
}

////////////////////////////////////////////////////
// ZOOM FUNCTIONALITY
////////////////////////////////////////////////////

//var zoomedIn = true;

function scrollToSelectedSeats() {
    var selectedSeats = $('.Seating-Area td[src*="sold"]');

    if (selectedSeats.length !== 0) {
        selectedSeats[0].scrollIntoView();
    }
}

//// Scales the theatre so that the seat images are their original size
//function zoomIn() {
//    var theatreWidth,
//        containerDiv,
//        containerWidth,
//        resizeAmount;

//    zoomedIn = true;

//    containerDiv = $('.Seating-Container').parent();

//    theatreWidth = $('.Seating-Theatre').data('originalsize');
//    containerWidth = containerDiv.width();

//    // Calculate percentage to resize by
//    resizeAmount = theatreWidth / containerWidth;

//    containerDiv.find('img, div, table, tr, td').each(function () {
//        var element = $(this);

//        element.width(resizeAmount * element.width());
//        element.height(resizeAmount * element.height());
//    });
//}

//// Scales the theatre so that all of the seats are visible
//function zoomOut() {
//    var theatreWidth,
//        containerDiv,
//        containerWidth,
//        resizeAmount;

//    zoomedIn = false;

//    containerDiv = $('.Seating-Container').parent();

//    theatreWidth = $('.Seating-Theatre').data('originalsize');
//    containerWidth = containerDiv.width();

//    // Calculate percentage to resize by
//    resizeAmount = containerWidth / theatreWidth;

//    containerDiv.find('img, div, table, tr, td').each(function () {
//        var element = $(this);

//        element.width(resizeAmount * element.width());
//        element.height(resizeAmount * element.height());
//    });
//}

//// Toggles the zoom level
//function zoomSeating() {
//    if (zoomedIn) {
//        zoomOut();
//    }
//    else {
//        zoomIn();
//        scrollToSelectedSeats();
//    }
//}

////////////////////////////////////////////////////
// FIXES
////////////////////////////////////////////////////

function roundNumber(num, dec) {
    var result = String(Math.round(num * Math.pow(10, dec)) / Math.pow(10, dec));
    if (result.indexOf('.') < 0) { result += '.'; }
    while (result.length - result.indexOf('.') <= dec) { result += '0'; }
    return parseFloat(result);
}

function fixRowSizes() {
    var areas = $('.Seating-Area'),
        areaHeight,
        rowHeight, area, areaLen,
        rows, row, rowsLen, i, j;

    for (j = 0, areaLen = areas.length; j < areaLen; j++) {
        area = $(areas[j]);
        rows = area.find('tr');

        areaHeight = area.parent().height() * (area[0].style.height.replace(/[^-\d\.]/g, '') / 100);

        rowHeight = roundNumber(areaHeight / rows.length, 2);

        for (i = 0, rowsLen = rows.length; i < rowsLen; i++) {
            row = $(rows[i]);

            row.css('line-height', rowHeight + 'px');
            row.css('height', rowHeight + 'px');
        }
    }
}

// Make sure the images are the correct size for their area
function fixImageSizes() {

}



// Collapse all rows which don't contain an image
//function collapseEmptyRows() {
//    rows = $(areas[j]).find('tr:not(:has(img))');

//    for (i = 0, rowsLen = rows.length; i < rowsLen; i++) {
//        row = $(rows[i]);

//        row.css('line-height', '0px');
//        row.css('height', '0px');
//    }
//}

// Centers the areas in backwards compatibility mode
function centerAreas() {
    var theatre = $('.Seating-Theatre'),
        container = theatre.parent();

    theatre.css('position', 'relative');
    theatre.css('left', container.width() / 2 - theatre.width() / 2 + 'px');
}

// Fix seat name labels
//function setSeatNameWidths() {
//    var seatLabels = $('.Seating-Area p'),
//        label, i, len, labelParent;

//    for (i = 0, len = seatLabels.length; i < len; i++) {
//        label = $(seatLabels[i]);
//        labelParent = label.parent();

//        label.width(labelParent.width());
//        label.css('line-height', labelParent.height() + 'px');
//    }
//}

function setSeatNameWidths() {
    var areas = $('.Seating-Area'), i, j, k, len, len2, len3;

    var leftRowLabels = $('.Seating-RowLabelContainer-Left tr');
    var rightRowLabels = $('.Seating-RowLabelContainer-Right tr');

    var currentRowIndex = 0;
    for (i = 0, len = areas.length; i < len; i++) {
        var rows = $(areas[i]).find('tr');
        for (j = 0, len2 = rows.length; j < len2; j++) {
            var row = $(rows[j]);
            var cells = row.find('td');
            for (k = 0, len3 = cells.length; k < len3; k++) {
                var cell = cells[k];
                var $cell = $(cell);
                var label = $cell.find('p');
                var img = $cell.find('img');
                label.width(img.width());
                label.css('line-hieght', img.height());
            }

            var rowHeight = row.height();

            $(leftRowLabels[currentRowIndex]).css('line-height', rowHeight + 'px');
            $(rightRowLabels[currentRowIndex]).css('line-height', rowHeight + 'px');

            currentRowIndex++;
        }
    }
}

////////////////////////////////////////////////////
// VALIDATION HELPERS
////////////////////////////////////////////////////

function ignoreSeatGapIfNoAdequateSpaceLeftInRow(row) {
    //In the case that there is only one EMPTY seat left on the entire row (after user has selected seats)
    //Ignore the 1 empty space validation rules
    var emptySeats = getSeatsInRowBasedOnStatus(row, EMPTY);
    if (emptySeats.length !== 1) {
        if (rowHasBetterGapsForSelectedSeats(row)) {
            return false;
        }
    }
    return true;
}


//Check if there are better gaps for the amount of seat selected
//E.g. say if there are two empty seat gaps (3 seats & 2 seats), and the user only wants 2 seats,
//We want them to fill up the 2 seats gap instead of the 3 seats one.
function rowHasBetterGapsForSelectedSeats(row) {
    var emptyGaps = getSeatsInContiguousOrder(row, EMPTY);
    var selectedSeats = getSeatsInRowBasedOnStatus(row, SELECTED);
    var emptySeats = getSeatsInRowBasedOnStatus(row, EMPTY);

    // When using multi seat select, this validation can be called prior to selecting any seats.
    if (selectedSeats.length < 1) {
        return false;
    }

    var soldSeats = getSeatsInRowBasedOnStatus(row, SOLD);
    if (soldSeats.length === 0) {
        if (adjacentSeatsAreEmpty(selectedSeats[0]) && adjacentSeatsAreEmpty(selectedSeats[selectedSeats.length - 1])) {
            return true;
        }
    }

    if (adjacentSeatsAreEmpty(selectedSeats[0]) && adjacentSeatsAreEmpty(selectedSeats[selectedSeats.length - 1])) {
        return true;
    }

    var maxGapLength = getMaxGapLength(emptyGaps);

    for (var i = 0; i < emptyGaps.length; i++) {
        if (emptyGaps[i].length - 1 > selectedSeats.length) {
            return true;
        }
        if (emptyGaps[i].length - 1 === selectedSeats.length) {
            if (selectedSeats.length === 1 && maxGapLength - 1 === selectedSeats.length) {
                return false;
            }

        }
        if (emptyGaps[i].length === selectedSeats.length) {
            if (selectedSeats.length === 1 && maxGapLength - 1 === selectedSeats.length) {
                return false;
            }
            if (adjacentSeatsAreEmpty(selectedSeats[0]) || adjacentSeatsAreEmpty(selectedSeats[selectedSeats.length - 1])) {
                return true;
            }
        }
    }

    if (emptySeats.length === selectedSeats.length && emptyGaps.length >= selectedSeats.length) {
        return true;
    }

    if (emptySeats.length < selectedSeats.length) {
        var contSelectedSeats = getSeatsInContiguousOrder(row, SELECTED);
        if (contSelectedSeats.length > 1) {
            return true;
        }
    }

    return false;
}

////////////////////////////////////////////////////
// GENERAL HELPERS
////////////////////////////////////////////////////

// Returns all seats with the specified status that are adjacent to the seat
function getSeatsContiguousFromSeat(seat, status, includeInputSeat) {
    var seats = [];

    if (includeInputSeat && seat.Status === status) {
        seats.push(seat);
    }

    // search left
    var leftStep = 1;
    var leftI = leftStep;
    while (true) {
        var nextLeftSeat = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + leftI);
        if (nextLeftSeat && nextLeftSeat.Status === status) {
            seats.push(nextLeftSeat);
            leftI++;
            continue;
        }
        break;
    }
    // search right
    var rightStep = -1;
    var RightI = rightStep;
    while (true) {
        var nextRightSeat = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + RightI);
        if (nextRightSeat && nextRightSeat.Status === status) {
            seats.push(nextRightSeat);
            RightI--;
            continue;
        }
        break;
    }

    return seats;
}

function getSeatsInRowBasedOnStatus(row, status) {
    var seats = [];
    for (var i = 0; i < row.Seats.length; i++) {
        if (row.Seats[i]) {
            if (row.Seats[i].Status === status) {
                seats.push(row.Seats[i]);
            }
        }
    }
    return seats;
}

function getSeatsInContiguousOrder(row, status) {
    var seatSets = [];
    var contiguousSeats = [];
    for (var i = 0; i < row.Seats.length; i++) {
        if (row.Seats[i]) {
            if (row.Seats[i].Status === status) {
                if (i === 0) {
                    contiguousSeats.push(row.Seats[i]);
                    continue;
                }
                if (row.Seats[i - 1]) {
                    if (row.Seats[i - 1].Status !== status) {
                        seatSets.push(contiguousSeats);
                        contiguousSeats = [];
                    }
                }

                contiguousSeats.push(row.Seats[i]);
            }
        }
    }

    if (contiguousSeats.length > 0) {
        seatSets.push(contiguousSeats);
    }

    return seatSets;
}

function adjacentSeatsAreEmpty(seat, checkBoth) {
    var seatToLeft = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex + 1);
    var seatToRight = getSeat(seat.area.AreaNumber, seat.RowIndex, seat.ColumnIndex - 1);

    if (seatToLeft && seatToRight && checkBoth) {
        if (seatToLeft.Status === EMPTY && seatToRight.Status === EMPTY) {
            return true;
        }
        return false;
    }

    if (seatToLeft && seatToRight) {
        if (seatToLeft.Status === EMPTY || seatToRight.Status === EMPTY) {
            return true;
        }
    }

    return false;
}

function getMaxGapLength(gaps) {
    var maxLength = 0;
    for (var i = 0; i < gaps.length; i++) {
        if (maxLength < gaps[i].length) {
            maxLength = gaps[i].length;
        }
    }
    return maxLength;
}

////////////////////////////////////////////////////
// ENTRY POINT
////////////////////////////////////////////////////

function initSeatingControl() {
    // Self-executing to preserve current behaviour
    // If the script is included then the control should be set up

    // assume script included at bottom of page
    // we must select the container in advance because we can't guarantee our $.ready executes before callers
    var container = $('.Seating-Control'),
        seatChangeCallback,
        areaChangeCallback;

    var init = function () {
        // Try to re-select in case script was included before the container


        seatingLoaded = true;
    };

    if (document.readyState === 'complete' || document.readyState === 'loaded') {
        init();
    } else {
        //For mobile layout we want to defer the execution until all resources (eg. images are loaded)
        $(window).load(init);
    }


    return methods;
};

//SeatingControl = initSeatingControl();
    var methods = {
        onSelectionChange: function (callback) {
            seatChangeCallback = callback;
        },

        onActiveAreaCategoryChange: function (callback) {
            areaChangeCallback = callback;
        },

        getSeatCount: getSeatCount,
        getSeatsNotAllocatedCountAllAreas: getSeatsNotAllocatedCountAllAreas,
        hasSelectedSeats: hasSelectedSeats,
        isSeatSelectionRequired: isSeatSelectionRequired,

        getAreaCategories: getAreaCategories,
        getSelectedSeats: getSelectedSeats,

        validate: validateSeating,
        setSelectedSeatsField: setSelectedSeatsField,
        selectSeat: selectSeat,
        deselectAllSeats: deselectAllSeats,

        setActiveAreaCategory: setActiveAreaCategory,

        isSequentialSeatMode: isSequentialSeatMode,

        isSeatBySeatSeatMode: isSeatBySeatSeatMode,

        isSeatFirst: function () {
            return m_isSeatFirst;
        },

        checkOnlyOnePartiallyFilledSofa: checkOnlyOnePartiallyFilledSofa,

        setMultiSeatSelect: setMultiSeatSelect
    };

    function onSeatKeyClick(event) {
        if (event.which === 13 || event.keyCode === 13) {
            onSeatClick.call(this, event);
        }
    }

    function onSeatClick(event) {
        var seatImage,
            targetTagName = event.target.tagName.toLowerCase(),
            message;

        if (targetTagName !== 'img') { // Missed the image
            if (targetTagName === 'p') { // When seat names are enabled this will be the seat name
                seatImage = $(event.target).next(); // The next sibling after the seat name is the image
            }
            else if (targetTagName === 'td' || targetTagName === 'div') {
                seatImage = $(event.target).find('img');
            }
            else { // This could be the table, or tbody and can't be used
                return;
            }
        }
        else {
            seatImage = $(event.target);  // wraps the seat in a jQuery object
        }

        if (seatImage.length === 0) {
            return; // Seat image not found
        }

        var areaNumber = $(this).data('area-number');

        var area = getArea(areaNumber),
            activeAreaChanged = false;

        if (isAreaDisabled(areaNumber) && (getAvailableSeatCount(area.AreaCategoryCode) > 0 || !isAreaCategoryAllocated(area.AreaCategoryCode))) {
            // Don't switch to disabled areas

            if (hasSelectedSeats()) {
                var confirmationMessage;
                var areaCategoryName = getAreaCategoryName(area.AreaCategoryCode);

                if (areaCategoryName) {
                    confirmationMessage = format(m_validationRules.ChangeAreaSpecific, areaCategoryName);
                }
                else {
                    confirmationMessage = m_validationRules.ChangeAreaGeneric;
                }

                if (!confirm(confirmationMessage)) {
                    // Return if the area does not become active
                    // Otherwise the click should continue through
                    return;
                }

            }

            setActiveAreaCategory(area.AreaCategoryCode);
            activeAreaChanged = true;
        }


        var seat = getSeat(areaNumber, seatImage.data('row'), seatImage.data('col'));
        // save seat status prior to updating it
        var priorSeatStatus = seat.Status;

        // If changing the active area category, don't trigger the click if the new area is unallocated
        if (!activeAreaChanged || area.IsAllocatedSeating) {
            message = seatClicked(seatImage, areaNumber);

            if (message) {
                showPopup(message);

                // no seat has been selected, no need to invoke the seat change callback
                if (priorSeatStatus === SOLD || priorSeatStatus === HOUSE || priorSeatStatus === BROKEN) {
                    return;
                }
            }
            else {
                hidePopup();
            }
        }

        // Fires even when validation fails
        if ((activeAreaChanged || area.IsAllocatedSeating) && typeof seatChangeCallback === 'function') {
            var hasDeselectedSeat = !isSeatStatusAvailable(priorSeatStatus) && isSeatStatusAvailable(seat.Status); // seat has been deselected if selected seat is now empty
            seatChangeCallback(seatImage, areaNumber, hasDeselectedSeat);
        }
    }

    function getAreaCategories() {
        var categories = [];

        for (var code in m_theatre.AreaCategories) {
            if (m_theatre.AreaCategories.hasOwnProperty(code))
                categories.push(m_theatre.AreaCategories[code]);
        }

        return categories;
    }



    function hasSelectedSeats() {
        for (var i = 0; i < m_selectedSeats.length; i++) {
            if (m_selectedSeats[i].Seats.length > 0)
                return true;
        }

        return false;
    }

    function isSeatSelectionRequired() {
        // this will be false when the active area category is unallocated
        var areaCategories = getAreaCategories();

        for (var i = 0; i < areaCategories.length; i++) {

            var areaNumbers = getAreaNumbersForAreaCategory(areaCategories[i].AreaCategoryCode);

            if (isAreaDisabled(areaNumbers)) // ignore disabled area categories
                continue;

            if (areaCategories[i].SeatsToAllocate > 0 && isAreaCategoryAllocated(areaCategories[i].AreaCategoryCode))
                return true;
        }

        return false;
    }

    function getSeatsNotAllocatedCountAllAreas() {
        var seatCount = 0;
        var areaCategories = getAreaCategories();
        for (var i = 0; i < areaCategories.length; i++) {
            var areaCategory = areaCategories[i];
            seatCount += areaCategory.SeatsNotAllocatedCount;
        }
        return seatCount;
    }

    function getAvailableSeatCount(areaCategoryCode) {
		console.log('cats');
		console.log(m_theatre.AreaCategories);
        return m_theatre.AreaCategories[areaCategoryCode].SeatsToAllocate;
    }

    function getSeatCount() {
        var sum = 0;

        for (var i = 0; i < m_selectedSeats.length; i++) {
            sum += m_selectedSeats[i].Seats.length;
        }

        return sum;
    }

    function getAreaCategoryName(areaCategoryCode) {
        if (m_areaCategoryNames.hasOwnProperty(areaCategoryCode))
            return m_areaCategoryNames[areaCategoryCode];
        else
            return '';
    }

    function getAreaNumbersForAreaCategory(areaCategoryCode) {
        var result = [];

        for (var i = 0; i < m_theatre.Areas.length; i++) {
            if (m_theatre.Areas[i].AreaCategoryCode === areaCategoryCode) {
                result.push(m_theatre.Areas[i].AreaNumber);
            }
        }

        return result;
    }

    function inArea(areaNumbers) {
        /// <param name="areaNumbers">An area number or an array of area numbers to match.</returns>
        /// <returns type="Function">Filter function for the specified area(s).</returns>

        if (!(areaNumbers instanceof Array))
            areaNumbers = [areaNumbers];

        return function () {
            for (var i = 0; i < areaNumbers.length; i++) {
                if (areaNumbers[i] === $(this).data('area-number'))
                    return true;
            }

            return false;
        };
    }

    function isAreaCategoryAllocated(areaCategoryCode) {
        var areas = getAreaNumbersForAreaCategory(areaCategoryCode);

        for (var i = 0; i < areas.length; i++) {
            if (getArea(areas[i]).IsAllocatedSeating)
                return true;
        }

        return false;
    }

    function getSeatsInGroup(seat) {
        var seats = [];

        if (seat.SeatsInGroup) {
            for (var i = 0; i < seat.SeatsInGroup.length; i++) {
                seats.push(getSeat(seat.area.AreaNumber, seat.SeatsInGroup[i].RowIndex, seat.SeatsInGroup[i].ColumnIndex));
            }
        }

        return seats;
    }

    function getSelectedSeats() {
        var seats = [];

        for (var i = 0; i < m_selectedSeats.length; i++) {
            for (var j = 0; j < m_selectedSeats[i].Seats.length; j++) {
                seats.push(getSeat(m_selectedSeats[i].Seats[j].AreaNumber, m_selectedSeats[i].Seats[j].RowIndex, m_selectedSeats[i].Seats[j].ColumnIndex));
            }
        }

        return seats;
    }

    function checkOnlyOnePartiallyFilledSofa() {
        if (!m_sofaSeatingEnabled) return true;

        var seats = getSelectedSeats(),
            sofaFilled = false,
            seatsExamined = [];

        for (var i = 0; i < seats.length; i++) {
            // Skip seats we've already checked
            if ($.inArray(seats[i], seatsExamined) !== -1) continue;

            var seatsInGroup = getSeatsInGroup(seats[i]);
            for (var j = 0; j < seatsInGroup.length; j++) {
                if (seatAvailable(seatsInGroup[j])) {
                    if (sofaFilled) return false;
                    sofaFilled = true;
                    break;
                }
            }

            // We need to track all seats in this group so we don't revalidate them
            Array.prototype.push.apply(seatsExamined, seatsInGroup);
        }

        return true;
    }

    function setActiveAreaCategory(areaCategoryCode) {
        // deselect seats in all other area categories
        for (var code in m_theatre.AreaCategories) {
            if (!m_theatre.AreaCategories.hasOwnProperty(code)) {
                continue;
            }

            if (code !== areaCategoryCode) {
                deselectAllSeats(code);
            }
        }

        var areaCategory;
        if (areaCategory = m_theatre.AreaCategories[areaCategoryCode]) {
            // Must be done after deselecting all seats for getSelectedSeats to return the correct value
            areaCategory.SeatsToAllocate = m_seatsToAllocate;
            areaCategory.SeatsNotAllocatedCount = m_seatsToAllocate - getSelectedSeats().length; // seats may arleady be selected
        }

        hidePopup(true /* suppress animation */);

        var areasForCategory = getAreaNumbersForAreaCategory(areaCategoryCode);

        // Disable inactive areas
        // Note the disabled class must be added directly onto the image
        // Doing it on the container will cause some overlapping areas to become unclickable due to new stacking context from opacity
        container.find('.Seating-Area')
            .data('scdisabled', false)
            .find('img')
            .removeClass('disabled')
            .end()
            .not(inArea(areasForCategory))
            .data('scdisabled', true)
            .find('img')
            .addClass('disabled');

        if (areaCategoryCode && !isAreaCategoryAllocated(areaCategoryCode)) {
            showPopup(m_validationRules.UnallocatedAreaSelected);
        }

        if (typeof areaChangeCallback === 'function') {
            areaChangeCallback(areaCategoryCode);
        }
    }

    function format(formatString) {
        /// <summary>string.format</summary>
        /// <param name="formatString" type="String">The format string.</param>
        for (var i = 0; i < arguments.length - 1; i++) {
            var regex = new RegExp('\\{' + i + '\\}', 'g');
            formatString = formatString.replace(regex, typeof arguments[i + 1] === 'undefined' ? '' : arguments[i + 1]);
        }

        return formatString;
    }

	</script>


<script type="text/javascript">
 function isAreaDisabled(areaNumber) {
        return container.find('.Seating-Area').filter(inArea(areaNumber)).data('scdisabled');
    }
	$(document).ready(function() {
		$( "#finishbooking" ).on( "click", function() {
			$( "#preloader" ).show();
			$( "#status" ).show();
			 setTimeout(function() {
                      	$( "#theseatform" ).submit();
                    }, 3000);


		});

		$( "#bookit" ).on( "click", function() {
		    var totalcartcount= shoppingCart.totalCount();

		    if(totalcartcount > 6){
		     	$('#errorseats2').modal('show');
		        //alert('يجب أختيار 6 مقاعد او أقل فقط');
		    }else{
		        	$.ajaxSetup({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    }
                    });
					$.ajax({
                        type: 'POST',
                        dataType: 'json',
                        url: '/setallsetseats',
                        dataType: 'json',
                        data: {

                            tkdata: JSON.stringify(cart),
							uservistaid: JSON.stringify( $('#muvistausidd').val() ),
							showtimesesid: JSON.stringify( $('#showtimeSessionId').val() ),
                        },
                        success: function(response) {
                             //alert(response['success']);
                             //console.log(response['success']);
                             var shopingcartreturn =JSON.parse(response['success']) ;
							  console.log(shopingcartreturn);
                             //alert(shoppingCart.tkseatname);
							 var confirmedtkts ='';
							 var returnttk =shopingcartreturn.order.sessions[0].tickets;

							 for (let i = 0; i < returnttk.length; i++) {
								  confirmedtkts += '<tr class="cart-ticket" style="">';
								  confirmedtkts += '<td class="name">'+returnttk[i].ticketDetails.description+'</td>';
								  confirmedtkts += '<td class="number cost">Row'+returnttk[i].seats[0].rowDisplay+'-'+returnttk[i].seats[0].columnDisplay+'</td>';
								  confirmedtkts += '<td class="number quantity">1</td>';
								  confirmedtkts += '<td class="number subtotal"><span class="price">'+returnttk[i].ticketDetails.finalPriceInCents/100+'</span> <span class="discount none"></span></td></tr>';
								}
							 //$('#thebookedseats').html(shopingcartreturn.tkseatname);
							  $('#confirmedtkts').html(confirmedtkts);
							   $('#summaryTotalprice').html(shopingcartreturn.order.orderTotalValueInCents/100);
							 $('#showcart').modal('show');

                        }
                    });

		    }




		});



		$( ".setsaets" ).on( "click", function() {

		 if($( this ).hasClass( "tkactive" )){
			 $( this ).removeClass( "tkactive" );
			   var areaNumber = $(this).data( "areanumber" );

        var area = getArea(areaNumber),
            activeAreaChanged = false;
			  var seat = getSeat(areaNumber, $(this).data( "seatinrow" ), $(this).data( "seatincol" ));
			 seat.Status =0;
			  var tkdata = {
                    tkprice: $(this).data( "tkprice" ),
                    tickettypecode: $(this).data( "tickettypecode" ),
                   areanumber : $(this).data( "areanumber" ),
					columnindex : $(this).data( "columnindex" ),
					rowindex : $(this).data( "rowindex" ),
					areacateg : $(this).data( "areacateg" ),

                };


				   tkprice= $(this).data( "tkprice" );
                    tickettypecode= $(this).data( "tickettypecode" );
                   areanumber = $(this).data( "areanumber" );
					columnindex = $(this).data( "columnindex" );
					rowindex = $(this).data( "rowindex" );
					areacateg = $(this).data( "areacateg" );
				  var name = areanumber+'-'+columnindex+'-'+rowindex+'-'+areacateg;
				  shoppingCart.removeItemFromCart(tickettypecode,areanumber,columnindex,rowindex);
				  //shoppingCart.addItemToCart(name , tkprice, tickettypecode, areanumber,columnindex,rowindex,areacateg, 1);


		 }else{

			   var areaNumber = $(this).data( "areanumber" );

        var area = getArea(areaNumber),
            activeAreaChanged = false;
			//console.log('the area:  ');
			//console.log(area);



        var seat = getSeat(areaNumber, $(this).data( "seatinrow" ), $(this).data( "seatincol" ));
		oneSeatOver = getSeat(areaNumber, $(this).data( "seatinrow" ), $(this).data( "seatincol" ) + 1);
		//console.log('oneSeatOver  =  '+oneSeatOver);
        // save seat status prior to updating it
		//console.log('the main seat:  ');
		//console.log(seat);
        var priorSeatStatus = seat.Status;
		 var oneSeatOver, twoSeatsOver;
		  if ($(this).data( "seatinrow" ) + 2 < seat.area.RowCount) { // Check row bounds

			}
			oneSeatOver = getSeat(areaNumber, $(this).data( "seatinrow" ), $(this).data( "seatincol" ) + 1);
				//console.log('oneSeatOver  =  '+oneSeatOver);
				//console.log(oneSeatOver);
				//alert();


				if (oneSeatOver && oneSeatOver.Status===0  ) {
					twoSeatsOver = getSeat(areaNumber, $(this).data( "seatinrow" ), $(this).data( "seatincol" ) + 2);

					if (twoSeatsOver) {

						if (twoSeatsOver.Status === 1) {
							//flashSeat(oneSeatOver);
							$('#errorseats').modal('show');
							return false;

						}
					}
				}

				 oneSeatOver = getSeat(areaNumber, $(this).data( "seatinrow" ), $(this).data( "seatincol" ) - 1);

        if (oneSeatOver && oneSeatOver.Status===0) {
					twoSeatsOver = getSeat(areaNumber, $(this).data( "seatinrow" ), $(this).data( "seatincol" ) - 2);

					if (twoSeatsOver) {
						if (twoSeatsOver.Status === 1) {
							//flashSeat(oneSeatOver);
							//alert('error');
							$('#errorseats').modal('show')
							return false;
						}
					}
				}
			 if ($(this).data( "seatinrow" ) - 2 > -1) {

			}
			//alert($(this).data( "seatincol" ) - 1);
			 if ($(this).data( "seatincol" ) - 1 === 0) {
        oneSeatOver = getSeat(areaNumber, $(this).data( "seatinrow" ), $(this).data( "seatincol" ) - 1);

        if (oneSeatOver && oneSeatOver.Status===0) {
					//flashSeat(oneSeatOver);
							//alert('error');
							$('#errorseats').modal('show')
							return false;

				}
			}


			 $( this ).addClass( "tkactive" );
			 seat.Status =1;
			 //console.log('stat=  '+seat.Status);
        // If changing the active area category, don't trigger the click if the new area is unallocated


        // Fires even when validation fails


		//movname showtime tkseatname
			  var tkdata = {
                    tkprice: $(this).data( "tkprice" ),
                    tickettypecode: $(this).data( "tickettypecode" ),
                   areanumber : $(this).data( "areanumber" ),
					columnindex : $(this).data( "columnindex" ),
					rowindex : $(this).data( "rowindex" ),
					areacateg : $(this).data( "areacateg" ),
					movname : $(this).data( "movname" ),
					showtime : $(this).data( "showtime" ),
					tkseatname : $(this).data( "tkseatname" ),
                };

				  tkprice= $(this).data( "tkprice" );
                    tickettypecode= $(this).data( "tickettypecode" );
                   areanumber = $(this).data( "areanumber" );
					columnindex = $(this).data( "columnindex" );
					rowindex = $(this).data( "rowindex" );
					areacateg = $(this).data( "areacateg" );
					movname = $(this).data( "movname" );
					showtime = $(this).data( "showtime" );
					tkseatname = $(this).data( "tkseatname" );
				  var name = areanumber+'-'+columnindex+'-'+rowindex+'-'+areacateg;;

				  shoppingCart.addItemToCart(name , tkprice, tickettypecode, areanumber,columnindex,rowindex,areacateg,movname,showtime,tkseatname, 1);
		 }



		} );


	});

	// ************************************************
// Shopping Cart API
// ************************************************

var shoppingCart = (function() {
  // =============================
  // Private methods and propeties
  // =============================
  cart = [];

  // Constructor
  function Item(name , tkprice, tickettypecode, areanumber,columnindex,rowindex,areacateg,movname,showtime,tkseatname,count) {

					this.name = tickettypecode;
                    this.tkprice = tkprice;
                    this.tickettypecode = tickettypecode;
                   this.areanumber= areanumber;
					this.columnindex =columnindex;
					this.rowindex = rowindex;
					this.areacateg = areacateg;
					this.movname = movname ;
					this.showtime =showtime ;
					this.tkseatname =tkseatname;
					this.count = count;
					this.seat =  [{'areaNumber' : areanumber,'columnIndex' :columnindex,'rowIndex':rowindex}];

  }

  // Save cart
  function saveCart() {
    sessionStorage.setItem('shoppingCart', JSON.stringify(cart));
	console.log(JSON.stringify(cart));
  }

    // Load cart
  function loadCart() {
    cart = JSON.parse(sessionStorage.getItem('shoppingCart'));
  }
  if (sessionStorage.getItem("shoppingCart") != null) {
    loadCart();
  }


  // =============================
  // Public methods and propeties
  // =============================
  var obj = {};

  // Add to cart
  obj.addItemToCart = function(name , tkprice, tickettypecode, areanumber,columnindex,rowindex,areacateg,movname,showtime,tkseatname,count) {
    for(var item in cart) {
      if(cart[item].name === tickettypecode) {
        cart[item].count ++;
		cart[item].tkseatname = cart[item].tkseatname+','+tkseatname;
		cart[item].seat.push({'areaNumber' : areanumber,'columnIndex' :columnindex,'rowIndex':rowindex});
        saveCart();
        return;
      }
    }
    var item = new Item(name , tkprice, tickettypecode, areanumber,columnindex,rowindex,areacateg,movname,showtime,tkseatname,count);
    cart.push(item);
    saveCart();
  }
  // Set count from item
  obj.setCountForItem = function(name, count) {
    for(var i in cart) {
      if (cart[i].name === name) {
        cart[i].count = count;
        break;
      }
    }
  };
  // Remove item from cart
  obj.removeItemFromCart = function(name,areanumber,columnindex,rowindex) {
      for(var item in cart) {
        if(cart[item].name === tickettypecode) {
          cart[item].count --;
          if(cart[item].count === 0) {
            cart.splice(item, 1);
          }else {
			  for(var st in cart[item].seat){
			   if(cart[item].seat[st].areaNumber === areanumber & cart[item].seat[st].columnIndex === columnindex & cart[item].seat[st].rowIndex === rowindex){
				    cart[item].seat.splice(st, 1);

			   }
		  }

		  }
          break;
        }
    }
    saveCart();
  }

  // Remove all items from cart
  obj.removeItemFromCartAll = function(name) {
    for(var item in cart) {
      if(cart[item].name === name) {
        cart.splice(item, 1);
        break;
      }
    }
    saveCart();
  }

  // Clear cart
  obj.clearCart = function() {
    cart = [];
    saveCart();
  }

  // Count cart
  obj.totalCount = function() {
    var totalCount = 0;
    for(var item in cart) {
      totalCount += cart[item].count;
    }
    return totalCount;
  }

  // Total cart
  obj.totalCart = function() {
    var totalCart = 0;
    for(var item in cart) {
      totalCart += cart[item].tkprice * cart[item].count;
    }
    return Number(totalCart.toFixed(2));
  }

  // List cart
  obj.listCart = function() {
    var cartCopy = [];
    for(i in cart) {
      item = cart[i];
      itemCopy = {};
      for(p in item) {
        itemCopy[p] = item[p];

      }
      itemCopy.total = Number(item.price * item.count).toFixed(2);
      cartCopy.push(itemCopy)
    }
    return cartCopy;
  }

  // cart : Array
  // Item : Object/Class
  // addItemToCart : Function
  // removeItemFromCart : Function
  // removeItemFromCartAll : Function
  // clearCart : Function
  // countCart : Function
  // totalCart : Function
  // listCart : Function
  // saveCart : Function
  // loadCart : Function
  return obj;
})();


// *****************************************
// Triggers / Events
// *****************************************
// Add item
$('.add-to-cart').click(function(event) {
  event.preventDefault();
  var name = $(this).data('name');
  var price = Number($(this).data('price'));
  shoppingCart.addItemToCart(name, price, 1);
  displayCart();
});

// Clear items
$('.clear-cart').click(function() {
  shoppingCart.clearCart();
  displayCart();
});


function displayCart() {
  var cartArray = shoppingCart.listCart();
  var output = "";
  for(var i in cartArray) {
    output += "<tr>"
      + "<td>" + cartArray[i].name + "</td>"
      + "<td>(" + cartArray[i].price + ")</td>"
      + "<td><div class='input-group'><button class='minus-item input-group-addon btn btn-primary' data-name=" + cartArray[i].name + ">-</button>"
      + "<input type='number' class='item-count form-control' data-name='" + cartArray[i].name + "' value='" + cartArray[i].count + "'>"
      + "<button class='plus-item btn btn-primary input-group-addon' data-name=" + cartArray[i].name + ">+</button></div></td>"
      + "<td><button class='delete-item btn btn-danger' data-name=" + cartArray[i].name + ">X</button></td>"
      + " = "
      + "<td>" + cartArray[i].total + "</td>"
      +  "</tr>";
  }
  $('.show-cart').html(output);
  $('.total-cart').html(shoppingCart.totalCart());
  $('.total-count').html(shoppingCart.totalCount());
}

// Delete item button

$('.show-cart').on("click", ".delete-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.removeItemFromCartAll(name);
  displayCart();
})


// -1
$('.show-cart').on("click", ".minus-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.removeItemFromCart(name);
  displayCart();
})
// +1
$('.show-cart').on("click", ".plus-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.addItemToCart(name);
  displayCart();
})

// Item count input
$('.show-cart').on("change", ".item-count", function(event) {
   var name = $(this).data('name');
   var count = Number($(this).val());
  shoppingCart.setCountForItem(name, count);
  displayCart();
});

//displayCart();

	</script>

<script>

 document.addEventListener("DOMContentLoaded", function(event) {
       shoppingCart.clearCart();

  });
   $('#preloader').css("display", "none");
</script>



</body>

</html>
